(()=>{var e={};e.id=5526,e.ids=[5526],e.modules={2413:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>i});var t=a(37413),r=a(4377);function i(){return(0,t.jsx)(r.BreakagesPage,{})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4377:(e,s,a)=>{"use strict";a.d(s,{BreakagesPage:()=>t});let t=(0,a(12907).registerClientReference)(function(){throw Error("Attempted to call BreakagesPage() from the server but BreakagesPage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/inchwara/sawela/app/breakages/components/BreakagesPage.tsx","BreakagesPage")},5632:(e,s,a)=>{Promise.resolve().then(a.bind(a,4377))},8902:(e,s,a)=>{"use strict";a.d(s,{BreakagesPage:()=>el});var t=a(60687),r=a(43210),i=a(71702),n=a(55192),l=a(71463),c=a(43649),d=a(48730),o=a(14719),m=a(35071);function x({breakages:e,loading:s}){if(s)return(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(l.E,{className:"h-4 w-24"}),(0,t.jsx)(l.E,{className:"h-4 w-4"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)(l.E,{className:"h-8 w-16 mb-1"}),(0,t.jsx)(l.E,{className:"h-3 w-32"})]})]},s))});let a=e.length,r=e.filter(e=>"pending"===e.approval_status).length,i=e.filter(e=>"approved"===e.approval_status).length,x=e.filter(e=>"rejected"===e.approval_status).length,h=e.reduce((e,s)=>e+s.items.length,0),p=e.reduce((e,s)=>e+s.items.reduce((e,s)=>e+s.quantity,0),0),u=e.reduce((e,s)=>e+s.items.filter(e=>e.replacement_requested).length,0);return(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Total Breakages"}),(0,t.jsx)(c.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:a}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[h," items • ",p," total qty"]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Pending Approval"}),(0,t.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:r}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting manager approval"})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Approved"}),(0,t.jsx)(o.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:i}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u," replacements requested"]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.ZB,{className:"text-sm font-medium",children:"Rejected"}),(0,t.jsx)(m.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-primary",children:x}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Rejected breakage reports"})]})]})]})}var h=a(85650),p=a(59821),u=a(24934),j=a(68988),g=a(63974),v=a(55629),y=a(96752),N=a(99270),b=a(96474),f=a(31158),_=a(78122),w=a(47033),k=a(14952),C=a(93661),A=a(13861),q=a(5336),E=a(19080),S=a(63143),B=a(88233);function R({breakages:e,loading:s,onViewBreakage:a,onEditBreakage:r,onDeleteBreakage:i,onApproveBreakage:n,onCreateDispatch:l,search:c,onSearchChange:d,currentPage:o,totalPages:m,rowsPerPage:x,onPageChange:v,onRowsPerPageChange:C,totalItems:A,onRefresh:q,onCreateNew:E}){let S=e=>{if(!e)return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Unknown"});switch(e.toLowerCase()){case"pending":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"approved":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Approved"});case"rejected":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:"Rejected"});case"replaced":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Replaced"});case"resolved":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Resolved"});case"dispatch_initiated":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Dispatch Initiated"});default:return(0,t.jsx)(p.E,{variant:"secondary",children:e})}},B=e=>{if(!e)return(0,t.jsx)(p.E,{variant:"outline",className:"border-gray-500 text-gray-700",children:"Unknown"});switch(e.toLowerCase()){case"pending":return(0,t.jsx)(p.E,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:"Pending Approval"});case"approved":return(0,t.jsx)(p.E,{variant:"outline",className:"border-green-500 text-green-700",children:"Approved"});case"rejected":return(0,t.jsx)(p.E,{variant:"outline",className:"border-red-500 text-red-700",children:"Rejected"});default:return(0,t.jsx)(p.E,{variant:"outline",children:e})}};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{className:"flex space-x-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(N.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500"}),(0,t.jsx)(j.p,{className:"pl-8 max-w-sm",placeholder:"Search breakages...",value:c,onChange:e=>d(e.target.value)})]})}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsxs)(u.$,{size:"sm",onClick:E,className:"bg-primary text-white hover:bg-primary/90",children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Report Breakage"]}),(0,t.jsxs)(u.$,{size:"sm",className:"bg-primary text-white hover:bg-primary/90",children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Export"]}),(0,t.jsxs)(u.$,{size:"sm",className:"bg-primary text-white hover:bg-primary/90",onClick:q,children:[(0,t.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),(0,t.jsx)("div",{className:"rounded-md border bg-white",children:(0,t.jsxs)(y.XI,{children:[(0,t.jsx)(y.A0,{children:(0,t.jsxs)(y.Hj,{children:[(0,t.jsx)(y.nd,{className:"font-semibold",children:"Breakage #"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Reporter"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Items"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Status"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Approval Status"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Approver"}),(0,t.jsx)(y.nd,{className:"font-semibold",children:"Created"}),(0,t.jsx)(y.nd,{className:"text-right font-semibold",children:"Actions"})]})}),(0,t.jsx)(y.BF,{children:s?(0,t.jsx)(y.Hj,{children:(0,t.jsx)(y.nA,{colSpan:8,className:"h-24 text-center",children:(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#1E2764]"}),(0,t.jsx)("span",{children:"Loading breakages..."})]})})}):0===e.length?(0,t.jsx)(y.Hj,{children:(0,t.jsx)(y.nA,{colSpan:8,className:"h-24 text-center",children:(0,t.jsxs)("div",{className:"text-gray-500",children:[(0,t.jsx)("p",{className:"font-semibold",children:"No breakages found"}),(0,t.jsx)("p",{className:"text-sm",children:"Create your first breakage report to get started"})]})})}):e.map(e=>{let s=e.items.filter(e=>e.replacement_requested).length;return(0,t.jsxs)(y.Hj,{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>a(e),children:[(0,t.jsx)(y.nA,{className:"font-medium",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-[#1E2764]",children:e.breakage_number}),e.notes&&(0,t.jsx)("span",{className:"text-xs text-gray-500 mt-1 truncate max-w-[150px]",children:e.notes})]})}),(0,t.jsx)(y.nA,{children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e.reporter?.first_name," ",e.reporter?.last_name]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.reporter?.email})]})}),(0,t.jsx)(y.nA,{children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e.items.length," item",1!==e.items.length?"s":""]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:s>0&&(0,t.jsxs)("span",{className:"text-orange-600",children:[s," replacement",1!==s?"s":""," requested"]})})]})}),(0,t.jsx)(y.nA,{children:S(e.status)}),(0,t.jsx)(y.nA,{children:B(e.approval_status)}),(0,t.jsx)(y.nA,{children:e.approver?(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e.approver.first_name," ",e.approver.last_name]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.approver.email})]}):(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Not yet assigned"})}),(0,t.jsx)(y.nA,{children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,h.GP)(new Date(e.created_at),"MMM dd, yyyy"),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,h.GP)(new Date(e.created_at),"HH:mm")})]})}),(0,t.jsx)(y.nA,{className:"text-right",onClick:e=>e.stopPropagation(),children:(0,t.jsx)($,{breakage:e,onView:()=>a(e),onEdit:()=>r(e),onDelete:()=>i(e),onApprove:()=>n(e),onCreateDispatch:()=>l(e)})})]},e.id)})})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Rows per page"}),(0,t.jsxs)(g.l6,{value:x.toString(),onValueChange:e=>{C(Number(e)),v(1)},children:[(0,t.jsx)(g.bq,{className:"h-8 w-[70px]",children:(0,t.jsx)(g.yv,{placeholder:x})}),(0,t.jsx)(g.gC,{side:"top",children:[5,10,20,30,40,50].map(e=>(0,t.jsx)(g.eb,{value:e.toString(),children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(u.$,{size:"sm",onClick:()=>v(Math.max(o-1,1)),disabled:1===o,className:"bg-primary text-white hover:bg-primary/90 disabled:opacity-50",children:[(0,t.jsx)(w.A,{className:"h-4 w-4"}),"Previous"]}),(0,t.jsxs)("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",o," of ",m||1]}),(0,t.jsxs)(u.$,{size:"sm",onClick:()=>v(Math.min(o+1,m||1)),disabled:o===m||0===m,className:"bg-primary text-white hover:bg-primary/90 disabled:opacity-50",children:["Next",(0,t.jsx)(k.A,{className:"h-4 w-4"})]})]})]})]})})}function $({breakage:e,onView:s,onEdit:a,onDelete:r,onApprove:i,onCreateDispatch:n}){let l="pending"===e.status&&"pending"===e.approval_status,c="pending"===e.status&&"pending"===e.approval_status,d="pending"===e.approval_status,o="approved"===e.approval_status&&"dispatch_initiated"!==e.status&&e.items.some(e=>e.replacement_requested);return(0,t.jsxs)(v.rI,{children:[(0,t.jsx)(v.ty,{asChild:!0,children:(0,t.jsx)(u.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,t.jsx)(C.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(v.SQ,{align:"end",children:[(0,t.jsx)(v.lp,{children:"Actions"}),(0,t.jsxs)(v._2,{onClick:s,children:[(0,t.jsx)(A.A,{className:"h-4 w-4 mr-2"})," View Details"]}),d&&(0,t.jsxs)(v._2,{onClick:i,className:"text-green-600 focus:text-green-600",children:[(0,t.jsx)(q.A,{className:"h-4 w-4 mr-2"})," Approve/Reject"]}),o&&(0,t.jsxs)(v._2,{onClick:n,className:"text-blue-600 focus:text-blue-600",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-2"})," Create Replacement Dispatch"]}),l&&(0,t.jsxs)(v._2,{onClick:a,children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Edit Breakage"]}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.mB,{}),(0,t.jsxs)(v._2,{onClick:r,className:"text-primary focus:text-primary",children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-2"})," Delete Breakage"]})]})]})]})}var P=a(92241),I=a(70373),D=a(41862),Z=a(58869),T=a(10022),J=a(62103);function M({open:e,onOpenChange:s,breakage:a,onClose:l,onRefresh:d,onEditBreakage:o,onDeleteBreakage:m,onApproveBreakage:x,onCreateDispatch:j}){let[g,v]=(0,r.useState)(null),[y,N]=(0,r.useState)(!1),{toast:b}=(0,i.dj)(),f=g?.status==="pending"&&g?.approval_status==="pending",w=g?.status==="pending"&&g?.approval_status==="pending",k=g?.approval_status==="pending",C=g?.approval_status==="approved"&&"dispatch_initiated"!==g.status&&g.items.some(e=>e.replacement_requested);return(0,t.jsx)(P.cj,{open:e,onOpenChange:s,children:(0,t.jsxs)(P.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,t.jsxs)(P.Fm,{className:"flex-shrink-0",children:[(0,t.jsx)(P.qp,{children:"Breakage Details"}),(0,t.jsx)(P.Qs,{children:g?`Breakage ${g.breakage_number}`:"View breakage details"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:y?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(D.A,{className:"h-8 w-8 animate-spin text-gray-400"})}):g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:g.breakage_number})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{if(!e)return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Unknown"});switch(e.toLowerCase()){case"pending":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"approved":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Approved"});case"rejected":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:"Rejected"});case"replaced":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Replaced"});case"resolved":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Resolved"});case"dispatch_initiated":return(0,t.jsx)(p.E,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Dispatch Initiated"});default:return(0,t.jsx)(p.E,{variant:"secondary",children:e})}})(g.status),(e=>{if(!e)return(0,t.jsx)(p.E,{variant:"outline",className:"border-gray-500 text-gray-700",children:"Unknown"});switch(e.toLowerCase()){case"pending":return(0,t.jsx)(p.E,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:"Pending Approval"});case"approved":return(0,t.jsx)(p.E,{variant:"outline",className:"border-green-500 text-green-700",children:"Approved"});case"rejected":return(0,t.jsx)(p.E,{variant:"outline",className:"border-red-500 text-red-700",children:"Rejected"});default:return(0,t.jsx)(p.E,{variant:"outline",children:e})}})(g.approval_status)]})]}),(0,t.jsxs)(n.BT,{children:["Created on ",(0,h.GP)(new Date(g.created_at),"MMMM dd, yyyy 'at' HH:mm")]})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Reporter"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(I.eu,{className:"h-8 w-8",children:(0,t.jsxs)(I.q5,{className:"bg-[#1E2764]/10 text-[#1E2764] text-sm",children:[g.reporter?.first_name?.[0]||"U",g.reporter?.last_name?.[0]||"N"]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:[g.reporter?.first_name," ",g.reporter?.last_name]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:g.reporter?.email})]})]})]}),g.approver&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,t.jsx)(q.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Approver"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(I.eu,{className:"h-8 w-8",children:(0,t.jsxs)(I.q5,{className:"bg-green-100 text-green-800 text-sm",children:[g.approver.first_name[0],g.approver.last_name[0]]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:[g.approver.first_name," ",g.approver.last_name]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:g.approver.email}),g.approved_at&&(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:["Approved on ",(0,h.GP)(new Date(g.approved_at),"MMM dd, yyyy 'at' HH:mm")]})]})]})]})]}),g.notes&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,t.jsx)(T.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Notes"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md",children:g.notes})]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,t.jsx)(E.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Broken Items"})]}),(0,t.jsxs)(n.BT,{children:[g.items?.length||0," products in this breakage report"]})]}),(0,t.jsx)(n.Wu,{children:g.items&&g.items.length>0?(0,t.jsx)("div",{className:"space-y-4",children:g.items.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(E.A,{className:"h-6 w-6 text-gray-500"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.product_name||e.assignableItem?.product_name||e.product?.name||"Product"}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[(0,t.jsxs)("span",{children:["Cause: ",e.cause]}),(e.variant_name||e.assignableItem?.variant_name||e.variant)&&(0,t.jsxs)("span",{children:["Variant: ",e.variant_name||e.assignableItem?.variant_name||e.variant?.name]}),e.replacement_requested&&(0,t.jsx)(p.E,{variant:"outline",className:"border-orange-500 text-orange-700",children:"Replacement Requested"})]}),e.notes&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.notes})]})]})}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold",children:["Qty: ",e.quantity]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.product?.unit_of_measurement||"units"})]})]},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(E.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No items in this breakage"})]})})]})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(c.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No breakage selected"})]})}),(0,t.jsx)(P.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>s(!1),children:"Close"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[C&&(0,t.jsxs)(u.$,{onClick:()=>{j&&g&&j(g)},className:"bg-blue-600 hover:bg-blue-700",children:[(0,t.jsx)(_.A,{className:"h-4 w-4 mr-1"}),"Create Replacement Dispatch"]}),k&&(0,t.jsxs)(u.$,{onClick:()=>{x&&g&&x(g)},className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(q.A,{className:"h-4 w-4 mr-1"}),"Approve/Reject"]}),f&&(0,t.jsxs)(u.$,{onClick:()=>{o&&g&&o(g)},className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Edit"]}),w&&(0,t.jsxs)(u.$,{variant:"destructive",onClick:()=>{m&&g&&m(g)},children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})})]})})}a(71420);var L=a(39390),W=a(15616),O=a(93437);let F=["handling_error","equipment_malfunction","transport_damage","storage_issue","manufacturing_defect","normal_wear","accident","other"],U={handling_error:"Handling Error",equipment_malfunction:"Equipment Malfunction",transport_damage:"Transport Damage",storage_issue:"Storage Issue",manufacturing_defect:"Manufacturing Defect",normal_wear:"Normal Wear",accident:"Accident",other:"Other"};function G({open:e,onOpenChange:s,onSuccess:a}){let[l,d]=(0,r.useState)(!1),[o,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)(!1),[v,y]=(0,r.useState)([]),[f,_]=(0,r.useState)([]),[w,k]=(0,r.useState)(""),{toast:C}=(0,i.dj)(),[A,q]=(0,r.useState)({approver_id:"",notes:"",items:[]}),[S,R]=(0,r.useState)({}),$=()=>{let e={};return A.approver_id||(e.approver_id="Approver is required"),0===A.items.length?e.items="At least one item is required":A.items.forEach((s,a)=>{s.assignable_item_id||(e[`item_${a}_item`]="Item is required"),s.quantity<=0&&(e[`item_${a}_quantity`]="Quantity must be greater than 0"),s.cause||(e[`item_${a}_cause`]="Cause is required");let t=v.find(e=>e.id===s.assignable_item_id);if(t){let r=t.received_quantity-(t.returned_quantity||0);s.quantity>r&&(e[`item_${a}_quantity`]=`Quantity cannot exceed available quantity (${r})`)}}),R(e),0===Object.keys(e).length},I=async()=>{if($()){d(!0);try{let e={approver_id:A.approver_id,notes:A.notes,items:A.items.map(e=>{let s=v.find(s=>s.id===e.assignable_item_id)||e.assignableItem;if(!s?.product_id)throw Error("Product ID is required for breakage item");return{assignable_item_id:e.assignable_item_id,product_id:s.product_id,quantity:e.quantity,cause:e.cause,replacement_requested:e.replacement_requested,notes:e.notes||void 0}})};await (0,J.PK)(e),C({title:"Success",description:"Breakage report created successfully."}),a(),s(!1)}catch(e){console.error("Error creating breakage:",e),C({title:"Error",description:"Failed to create breakage report. Please try again.",variant:"destructive"})}finally{d(!1)}}},Z=e=>{A.items.length>1&&q(s=>({...s,items:s.items.filter((s,a)=>a!==e)}))},T=(e,s)=>{q(a=>({...a,items:a.items.map((a,t)=>{if(t===e){let e={...a,...s};return s.assignable_item_id&&s.assignable_item_id!==a.assignable_item_id&&(e.quantity=1,e.assignableItem=v.find(e=>e.id===s.assignable_item_id)),e}return a})}))},M=e=>{let s=v.find(s=>s.id===e);return s?s.received_quantity-(s.returned_quantity||0):0},G=(0,r.useMemo)(()=>w?v.filter(e=>e.product_name.toLowerCase().includes(w.toLowerCase())||e.variant_name&&e.variant_name.toLowerCase().includes(w.toLowerCase())):v,[v,w]);return(0,t.jsx)(P.cj,{open:e,onOpenChange:s,children:(0,t.jsxs)(P.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,t.jsxs)(P.Fm,{className:"flex-shrink-0",children:[(0,t.jsx)(P.qp,{children:"Report Breakage"}),(0,t.jsx)(P.Qs,{children:"Create a new breakage report with damaged items"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:[(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"Approver"}),(0,t.jsx)(n.BT,{children:"Select the user who will approve this breakage report"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"approver_id",children:"Approver *"}),(0,t.jsxs)(g.l6,{value:A.approver_id,onValueChange:e=>q(s=>({...s,approver_id:e})),disabled:x,children:[(0,t.jsx)(g.bq,{className:S.approver_id?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select approver"})}),(0,t.jsx)(g.gC,{children:f.map(e=>(0,t.jsx)(g.eb,{value:e.id,children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.email})]})},e.id))})]}),S.approver_id&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:S.approver_id})]})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"Add Products to Breakage Report"}),(0,t.jsx)(n.BT,{children:"Search and select products from dispatched items to add to this breakage report"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Search Products"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)(j.p,{type:"text",placeholder:"Search products by name...",value:w,onChange:e=>k(e.target.value),className:"pl-10"})]})]}),w&&(0,t.jsx)("div",{className:"max-h-64 overflow-y-auto border rounded-lg",children:o?(0,t.jsxs)("div",{className:"p-4 text-center text-gray-500",children:[(0,t.jsx)(D.A,{className:"h-5 w-5 animate-spin mx-auto mb-2"}),"Loading products..."]}):0===G.length?(0,t.jsxs)("div",{className:"p-4 text-center text-gray-500",children:['No products found matching "',w,'"']}):(0,t.jsx)("div",{className:"divide-y",children:G.map(e=>{let s=e.received_quantity-(e.returned_quantity||0),a=A.items.some(s=>s.assignable_item_id===e.id);return(0,t.jsx)("div",{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium",children:[e.product?.name||e.product_name||e.product_id,(e.variant?.name||e.variant_name||e.product_variant)&&(0,t.jsxs)("span",{className:"text-gray-500",children:[" - ",e.variant?.name||e.variant_name||e.product_variant]})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Dispatch: ",e.dispatch_number," • Available: ",s]})]}),s<=0&&(0,t.jsx)(p.E,{variant:"destructive",className:"text-xs",children:"Unavailable"}),a&&(0,t.jsx)(p.E,{variant:"secondary",className:"text-xs",children:"Already Added"})]})}),(0,t.jsxs)(u.$,{size:"sm",onClick:()=>{if(a)return void C({title:"Item already added",description:"This product is already in the breakage list.",variant:"destructive"});q(s=>({...s,items:[...s.items,{assignable_item_id:e.id,quantity:1,cause:"",replacement_requested:!1,notes:"",assignableItem:e}]})),C({title:"Item Added",description:`${e.product?.name||e.product_name} added to breakage report`})},disabled:s<=0||a,className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-1"}),"Add"]})]})},e.id)})})})]})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)(n.ZB,{className:"text-lg",children:["Broken Items (",A.items.length,")"]}),(0,t.jsx)(n.BT,{children:"Items added to this breakage report"})]})})}),(0,t.jsxs)(n.Wu,{children:[S.items&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:S.items})}),0===A.items.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(E.A,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),(0,t.jsx)("p",{children:"No products added yet"}),(0,t.jsx)("p",{className:"text-sm",children:"Use the search above to add products to this breakage report"})]}):(0,t.jsx)("div",{className:"space-y-6",children:A.items.map((e,s)=>{let a=v.find(s=>s.id===e.assignable_item_id)||e.assignableItem,r=a?M(e.assignable_item_id):0;return(0,t.jsxs)("div",{className:"border rounded-lg p-4 relative",children:[(0,t.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>Z(s),className:"absolute top-2 right-2 text-gray-400 hover:text-primary",children:(0,t.jsx)(B.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Product"}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-medium",children:[a?.product?.name||a?.product_name||a?.product_id,(a?.variant?.name||a?.variant_name||a?.product_variant)&&` - ${a?.variant?.name||a?.variant_name||a?.product_variant}`]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Dispatch: ",a?.dispatch_number," • Available: ",r]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Quantity *"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(j.p,{type:"number",min:"1",max:r,value:e.quantity,onChange:e=>T(s,{quantity:parseInt(e.target.value)||1}),className:S[`item_${s}_quantity`]?"border-red-500":""}),r>0&&(0,t.jsx)("div",{className:"flex items-center px-3 bg-gray-100 rounded-md text-sm",children:(0,t.jsxs)("span",{className:"text-gray-500",children:["Available: ",r]})})]}),S[`item_${s}_quantity`]&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:S[`item_${s}_quantity`]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Cause *"}),(0,t.jsxs)(g.l6,{value:e.cause,onValueChange:e=>T(s,{cause:e}),children:[(0,t.jsx)(g.bq,{className:S[`item_${s}_cause`]?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select cause of breakage"})}),(0,t.jsx)(g.gC,{children:F.map(e=>(0,t.jsx)(g.eb,{value:e,children:U[e]},e))})]}),S[`item_${s}_cause`]&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:S[`item_${s}_cause`]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(O.S,{checked:e.replacement_requested,onCheckedChange:e=>T(s,{replacement_requested:!!e})}),(0,t.jsx)(L.J,{className:"text-sm",children:"Request replacement for this item"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Item Notes"}),(0,t.jsx)(W.T,{placeholder:"Additional details about this broken item...",value:e.notes,onChange:e=>T(s,{notes:e.target.value}),rows:2})]})]})]})]},s)})})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"General Information"}),(0,t.jsx)(n.BT,{children:"Add any general notes about this breakage incident"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"notes",children:"General Notes"}),(0,t.jsx)(W.T,{id:"notes",placeholder:"Describe the incident, circumstances, or any additional context...",value:A.notes,onChange:e=>q(s=>({...s,notes:e.target.value})),rows:3})]})})]})]}),(0,t.jsx)(P.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,t.jsxs)(u.$,{onClick:I,disabled:l||0===A.items.length,className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[l?(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Report Breakage"]})]})})]})})}var V=a(96241);let H=["handling_error","equipment_malfunction","transport_damage","storage_issue","manufacturing_defect","normal_wear","accident","other"],Q={handling_error:"Handling Error",equipment_malfunction:"Equipment Malfunction",transport_damage:"Transport Damage",storage_issue:"Storage Issue",manufacturing_defect:"Manufacturing Defect",normal_wear:"Normal Wear",accident:"Accident",other:"Other"};function z({open:e,onOpenChange:s,onSuccess:a,breakage:l}){let[d,o]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[h,v]=(0,r.useState)([]),[y,f]=(0,r.useState)(""),[_,w]=(0,r.useState)(null),{toast:k}=(0,i.dj)(),[C,A]=(0,r.useState)({notes:"",items:[]}),[q,R]=(0,r.useState)({}),$=()=>{let e={};return 0===C.items.length?e.items="At least one item is required":C.items.forEach((s,a)=>{s.assignable_item_id||(e[`item_${a}_item`]="Item is required"),s.quantity<=0&&(e[`item_${a}_quantity`]="Quantity must be greater than 0"),s.cause||(e[`item_${a}_cause`]="Cause is required");let t=h.find(e=>e.id===s.assignable_item_id);if(t){let r=t.received_quantity-(t.returned_quantity||0);s.quantity>r&&(e[`item_${a}_quantity`]=`Quantity cannot exceed available quantity (${r})`)}}),R(e),0===Object.keys(e).length},I=async()=>{if($()&&l){o(!0);try{let e={...C,items:C.items.map(e=>{let s=h.find(s=>s.id===e.assignable_item_id)||e.assignableItem;return{id:e.id,assignable_item_id:e.assignable_item_id,product_id:s?.product_id,quantity:e.quantity,cause:e.cause,replacement_requested:e.replacement_requested,notes:e.notes||void 0}})};await (0,J.KZ)(l.id,e),k({title:"Success",description:"Breakage report updated successfully."}),a(),s(!1)}catch(e){console.error("Error updating breakage:",e),k({title:"Error",description:"Failed to update breakage report. Please try again.",variant:"destructive"})}finally{o(!1)}}},Z=e=>{C.items.length>1&&A(s=>({...s,items:s.items.filter((s,a)=>a!==e)}))},T=(e,s)=>{A(a=>({...a,items:a.items.map((a,t)=>{if(t===e){let e={...a,...s};return s.assignable_item_id&&s.assignable_item_id!==a.assignable_item_id&&(e.quantity=1,e.assignableItem=h.find(e=>e.id===s.assignable_item_id)),e}return a})}))},M=e=>{let s=h.find(s=>s.id===e);return s?s.received_quantity-(s.returned_quantity||0):0},F=l?.approval_status==="pending",U=(0,r.useMemo)(()=>y?h.filter(e=>e.product_name.toLowerCase().includes(y.toLowerCase())||e.variant_name&&e.variant_name.toLowerCase().includes(y.toLowerCase())):h,[h,y]);return(0,t.jsx)(P.cj,{open:e,onOpenChange:s,children:(0,t.jsxs)(P.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl xl:max-w-4xl flex flex-col h-full",children:[(0,t.jsxs)(P.Fm,{className:"flex-shrink-0",children:[(0,t.jsx)(P.qp,{children:"Edit Breakage Report"}),(0,t.jsx)(P.Qs,{children:l?`Editing breakage ${l.breakage_number}`:"Edit breakage report"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:[!F&&(0,t.jsx)(n.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 text-yellow-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-yellow-800",children:"Editing Restricted"}),(0,t.jsxs)("p",{className:"text-sm text-yellow-700",children:["This breakage report cannot be edited because it has been ",l?.approval_status,". Only pending reports can be modified."]})]})]})})}),l&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,t.jsx)(E.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Breakage Information"})]})}),(0,t.jsx)(n.Wu,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Breakage Number"}),(0,t.jsx)("p",{className:"text-sm text-gray-700",children:l.breakage_number})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Status"}),(0,t.jsx)(p.E,{variant:"pending"===l.status?"secondary":"default",children:l.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Approval Status"}),(0,t.jsx)(p.E,{variant:"approved"===l.approval_status?"default":"rejected"===l.approval_status?"destructive":"secondary",children:l.approval_status})]})]})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"General Information"}),(0,t.jsx)(n.BT,{children:"Add any general notes about this breakage incident"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"notes",children:"General Notes"}),(0,t.jsx)(W.T,{id:"notes",placeholder:"Describe the incident, circumstances, or any additional context...",value:C.notes,onChange:e=>A(s=>({...s,notes:e.target.value})),rows:3,disabled:!F})]})})]}),F&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"Add Products to Breakage Report"}),(0,t.jsx)(n.BT,{children:"Search and select additional products to add to this breakage report"})]}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Search Products"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(N.A,{className:"h-4 w-4 text-gray-400"})}),(0,t.jsx)(j.p,{type:"text",placeholder:"Search for products to add...",value:y,onChange:e=>f(e.target.value),className:"pl-10"})]})]}),y&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Available Products"}),(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto border rounded-md",children:U.length>0?(0,t.jsx)("div",{className:"space-y-1 p-2",children:U.map(e=>{let s=e.received_quantity-(e.returned_quantity||0),a=C.items.some(s=>s.assignable_item_id===e.id);return(0,t.jsx)("div",{className:(0,V.cn)("p-3 rounded-lg border cursor-pointer transition-colors",_?.id===e.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50 border-gray-200",a&&"opacity-50 cursor-not-allowed"),onClick:()=>!a&&w(e),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.product?.name||e.product_name||e.product_id,(e.variant?.name||e.variant_name||e.product_variant)&&` - ${e.variant?.name||e.variant_name||e.product_variant}`]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Dispatch: ",e.dispatch_number]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(p.E,{variant:"secondary",children:["Available: ",s]}),a&&(0,t.jsx)(p.E,{variant:"destructive",children:"Added"})]})]})},e.id)})}):(0,t.jsx)("div",{className:"p-4 text-center text-gray-500",children:"No products found matching your search"})})]}),_&&(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-medium",children:[_.product?.name||_.product_name||_.product_id,(_.variant?.name||_.variant_name||_.product_variant)&&` - ${_.variant?.name||_.variant_name||_.product_variant}`]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Dispatch: ",_.dispatch_number," • Available: ",_.received_quantity-(_.returned_quantity||0)]})]}),(0,t.jsxs)(u.$,{onClick:()=>{if(_&&F){if(C.items.find(e=>e.assignable_item_id===_.id))return void k({title:"Item already added",description:"This product is already in the breakage list.",variant:"destructive"});A(e=>({...e,items:[...e.items,{assignable_item_id:_.id,quantity:1,cause:"",replacement_requested:!1,notes:"",assignableItem:_}]})),w(null),f("")}},className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Add to Breakage"]})]})]})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)(n.ZB,{className:"text-lg",children:["Broken Items (",C.items.length,")"]}),(0,t.jsx)(n.BT,{children:"Items in this breakage report"})]})})}),(0,t.jsxs)(n.Wu,{children:[q.items&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:q.items})}),0===C.items.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(E.A,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),(0,t.jsx)("p",{children:"No products in this breakage report"}),F&&(0,t.jsx)("p",{className:"text-sm",children:"Use the search above to add products to this breakage report"})]}):(0,t.jsx)("div",{className:"space-y-6",children:C.items.map((e,s)=>{let a=h.find(s=>s.id===e.assignable_item_id)||e.assignableItem,r=a?M(e.assignable_item_id):0;return(0,t.jsxs)("div",{className:"border rounded-lg p-4 relative",children:[F&&(0,t.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>Z(s),className:"absolute top-2 right-2 text-gray-400 hover:text-primary",children:(0,t.jsx)(B.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Product"}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-medium",children:[a?.product?.name||a?.product_name||a?.product_id,(a?.variant?.name||a?.variant_name||a?.product_variant)&&` - ${a?.variant?.name||a?.variant_name||a?.product_variant}`]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Dispatch: ",a?.dispatch_number," • Available: ",r]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Quantity *"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(j.p,{type:"number",min:"1",max:r,value:e.quantity,onChange:e=>T(s,{quantity:parseInt(e.target.value)||1}),className:q[`item_${s}_quantity`]?"border-red-500":"",disabled:!F}),r>0&&(0,t.jsx)("div",{className:"flex items-center px-3 bg-gray-100 rounded-md text-sm",children:(0,t.jsxs)("span",{className:"text-gray-500",children:["Available: ",r]})})]}),q[`item_${s}_quantity`]&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q[`item_${s}_quantity`]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Cause *"}),(0,t.jsxs)(g.l6,{value:e.cause,onValueChange:e=>T(s,{cause:e}),disabled:!F,children:[(0,t.jsx)(g.bq,{className:q[`item_${s}_cause`]?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select cause of breakage"})}),(0,t.jsx)(g.gC,{children:H.map(e=>(0,t.jsx)(g.eb,{value:e,children:Q[e]},e))})]}),q[`item_${s}_cause`]&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q[`item_${s}_cause`]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(O.S,{checked:e.replacement_requested,onCheckedChange:e=>T(s,{replacement_requested:!!e}),disabled:!F}),(0,t.jsx)(L.J,{className:"text-sm",children:"Request replacement for this item"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Item Notes"}),(0,t.jsx)(W.T,{placeholder:"Additional details about this broken item...",value:e.notes,onChange:e=>T(s,{notes:e.target.value}),rows:2,disabled:!F})]})]})]})]},s)})})]})]})]}),(0,t.jsx)(P.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>s(!1),children:F?"Cancel":"Close"}),F&&(0,t.jsxs)(u.$,{onClick:I,disabled:d||0===C.items.length,className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[d?(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Update Breakage"]})]})})]})})}var X=a(35876);a(56792);var K=a(17313);function Y({open:e,onOpenChange:s,onSuccess:a,breakage:l}){let[d,o]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!1),[N,b]=(0,r.useState)([]),[f,w]=(0,r.useState)([]),{toast:k}=(0,i.dj)(),[C,A]=(0,r.useState)({from_store_id:"",to_entity:"",to_user_id:"",type:"internal",notes:"",items:[]}),[q,E]=(0,r.useState)({}),S=()=>{let e={};return C.from_store_id||(e.from_store_id="From store is required"),C.to_entity||(e.to_entity="To entity is required"),C.to_user_id||(e.to_user_id="Assigned user is required"),0===C.items.length?e.items="At least one item is required":C.items.forEach((s,a)=>{s.quantity<=0&&(e[`item_${a}_quantity`]="Quantity must be greater than 0")}),E(e),0===Object.keys(e).length},B=async()=>{if(S()&&l){o(!0);try{let e={...C,items:C.items.map(e=>({product_id:e.product_id,variant_id:e.variant_id||void 0,quantity:e.quantity,is_returnable:e.is_returnable,return_date:e.return_date||void 0,notes:e.notes||void 0}))},t=await (0,X.DI)(e);"success"===t.status&&(await (0,J.Id)(l.id,"dispatch_initiated"),k({title:"Success",description:`Replacement dispatch created successfully for breakage ${l.breakage_number}`}),a(),s(!1))}catch(e){console.error("Error creating dispatch:",e),k({title:"Error",description:"Failed to create dispatch. Please try again.",variant:"destructive"})}finally{o(!1)}}},R=(e,s)=>{A(a=>({...a,items:a.items.map((a,t)=>t===e?{...a,...s}:a)}))};return(0,t.jsx)(P.cj,{open:e,onOpenChange:s,children:(0,t.jsxs)(P.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl xl:max-w-4xl flex flex-col h-full",children:[(0,t.jsxs)(P.Fm,{className:"flex-shrink-0",children:[(0,t.jsx)(P.qp,{children:"Create Replacement Dispatch"}),(0,t.jsx)(P.Qs,{children:l?`Create dispatch for breakage ${l.breakage_number}`:"Create replacement dispatch"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:[l&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Breakage Information"})]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Breakage Number"}),(0,t.jsx)("p",{className:"text-sm text-gray-700",children:l.breakage_number})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Reported By"}),(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:[l.reporter?.first_name," ",l.reporter?.last_name]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Date Reported"}),(0,t.jsx)("p",{className:"text-sm text-gray-700",children:(0,h.GP)(new Date(l.created_at),"MMM dd, yyyy")})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("h4",{className:"font-medium text-gray-900 mb-3",children:["Items Requiring Replacement (",C.items.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:C.items.map((e,s)=>(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.product?.name}),e.variant&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Variant: ",e.variant.name]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["SKU: ",e.product?.sku]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Qty: ",e.quantity]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.product?.unit_of_measurement})]})]}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium",children:"Notes: "}),e.notes]})]},s))})]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,t.jsx)(K.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Dispatch Information"})]}),(0,t.jsx)(n.BT,{children:"Set up the replacement dispatch details"})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"from_store_id",children:"From Store *"}),(0,t.jsxs)(g.l6,{value:C.from_store_id,onValueChange:e=>A(s=>({...s,from_store_id:e})),disabled:m,children:[(0,t.jsx)(g.bq,{className:q.from_store_id?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select store to dispatch from"})}),(0,t.jsx)(g.gC,{children:N.map(e=>(0,t.jsx)(g.eb,{value:e.id,children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})},e.id))})]}),q.from_store_id&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q.from_store_id})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"to_entity",children:"To Entity *"}),(0,t.jsxs)(g.l6,{value:C.to_entity,onValueChange:e=>A(s=>({...s,to_entity:e})),children:[(0,t.jsx)(g.bq,{className:q.to_entity?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select destination"})}),(0,t.jsxs)(g.gC,{children:[(0,t.jsx)(g.eb,{value:"warehouse",children:"Warehouse"}),(0,t.jsx)(g.eb,{value:"store",children:"Store"}),(0,t.jsx)(g.eb,{value:"contractor",children:"Contractor"}),(0,t.jsx)(g.eb,{value:"employee",children:"Employee"})]})]}),q.to_entity&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q.to_entity})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"to_user_id",children:"Assigned User *"}),(0,t.jsxs)(g.l6,{value:C.to_user_id,onValueChange:e=>A(s=>({...s,to_user_id:e})),disabled:v,children:[(0,t.jsx)(g.bq,{className:q.to_user_id?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select user to assign dispatch to"})}),(0,t.jsx)(g.gC,{children:f.map(e=>(0,t.jsx)(g.eb,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),l&&e.id===l.reported_by&&(0,t.jsx)(p.E,{variant:"secondary",className:"text-xs",children:"Reporter"})]})},e.id))})]}),q.to_user_id&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q.to_user_id})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(W.T,{id:"notes",placeholder:"Add any additional notes about this replacement dispatch...",value:C.notes,onChange:e=>A(s=>({...s,notes:e.target.value})),rows:3})]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"text-lg",children:["Replacement Items (",C.items.length,")"]}),(0,t.jsx)(n.BT,{children:"Items to be dispatched as replacements"})]}),(0,t.jsxs)(n.Wu,{children:[q.items&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:q.items})}),(0,t.jsx)("div",{className:"space-y-4",children:C.items.map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Product"}),(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-medium",children:[e.product?.name,e.variant&&` - ${e.variant.name}`]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["SKU: ",e.product?.sku," • Unit: ",e.product?.unit_of_measurement]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Quantity *"}),(0,t.jsx)(j.p,{type:"number",min:"1",value:e.quantity,onChange:e=>R(s,{quantity:parseInt(e.target.value)||1}),className:q[`item_${s}_quantity`]?"border-red-500":""}),q[`item_${s}_quantity`]&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:q[`item_${s}_quantity`]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Returnable"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,t.jsx)(O.S,{checked:e.is_returnable,onCheckedChange:e=>R(s,{is_returnable:!!e})}),(0,t.jsx)("span",{className:"text-sm",children:"Item is returnable"})]})]})]}),e.is_returnable&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Return Date"}),(0,t.jsx)(j.p,{type:"date",value:e.return_date||"",onChange:e=>R(s,{return_date:e.target.value}),min:(0,h.GP)(new Date,"yyyy-MM-dd")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Item Notes"}),(0,t.jsx)(W.T,{placeholder:"Additional notes for this replacement item...",value:e.notes,onChange:e=>R(s,{notes:e.target.value}),rows:2})]})]})},s))})]})]})]}),(0,t.jsx)(P.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,t.jsxs)(u.$,{onClick:B,disabled:d||0===C.items.length,className:"bg-[#1E2764] hover:bg-[#1E2764]/90",children:[d?(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Create Replacement Dispatch"]})]})})]})})}var ee=a(95033);function es({open:e,onOpenChange:s,onSuccess:a,breakage:n}){let[l,d]=(0,r.useState)(!1),{toast:o}=(0,i.dj)(),m=async()=>{if(n){d(!0);try{await (0,J.gh)(n.id),o({title:"Success",description:`Breakage ${n.breakage_number} has been deleted successfully.`}),a(),s(!1)}catch(e){console.error("Delete error:",e),o({title:"Error",description:e.message||"Failed to delete breakage",variant:"destructive"})}finally{d(!1)}}};return(n?.status!=="pending"||n?.approval_status!=="pending")&&n?(0,t.jsx)(ee.Lt,{open:e,onOpenChange:s,children:(0,t.jsxs)(ee.EO,{children:[(0,t.jsxs)(ee.wd,{children:[(0,t.jsxs)(ee.r7,{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 text-red-500"}),(0,t.jsx)("span",{children:"Cannot Delete Breakage"})]}),(0,t.jsxs)(ee.$v,{children:["Breakage ",n.breakage_number," cannot be deleted because it has already been ",n.status,". Only pending breakages can be deleted."]})]}),(0,t.jsx)(ee.ck,{children:(0,t.jsx)(ee.Zr,{children:"Close"})})]})}):(0,t.jsx)(ee.Lt,{open:e,onOpenChange:s,children:(0,t.jsxs)(ee.EO,{children:[(0,t.jsxs)(ee.wd,{children:[(0,t.jsxs)(ee.r7,{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 text-red-500"}),(0,t.jsx)("span",{children:"Delete Breakage"})]}),(0,t.jsxs)(ee.$v,{children:["Are you sure you want to delete breakage"," ",(0,t.jsx)("span",{className:"font-semibold",children:n?.breakage_number}),"? This action cannot be undone."]})]}),(0,t.jsxs)(ee.ck,{children:[(0,t.jsx)(ee.Zr,{disabled:l,children:"Cancel"}),(0,t.jsx)(ee.Rx,{onClick:m,disabled:l,className:"bg-primary hover:bg-primary/90 focus:ring-primary",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Breakage"})]})]})})}var ea=a(40228),et=a(90103);let er=["insufficient_evidence","not_a_breakage","user_negligence","duplicate_report","missing_information","policy_violation","other"],ei={insufficient_evidence:"Insufficient Evidence",not_a_breakage:"Not a Breakage",user_negligence:"User Negligence",duplicate_report:"Duplicate Report",missing_information:"Missing Information",policy_violation:"Policy Violation",other:"Other"};function en({open:e,onOpenChange:s,onSuccess:a,breakage:l}){let[d,x]=(0,r.useState)(!1),{toast:j}=(0,i.dj)(),[v,y]=(0,r.useState)({decision:"",approval_notes:"",rejection_reason:void 0}),[N,b]=(0,r.useState)({}),f=()=>{let e={};return v.decision||(e.decision="Please select approve or reject"),"rejected"!==v.decision||v.rejection_reason||(e.rejection_reason="Rejection reason is required"),v.approval_notes.trim()||(e.approval_notes="Notes are required"),b(e),0===Object.keys(e).length},_=async()=>{if(f()&&l){x(!0);try{let e={approval_status:v.decision,notes:v.approval_notes.trim(),rejection_reason:"rejected"===v.decision?v.rejection_reason:void 0};await (0,J.q)(l.id,e),j({title:"Success",description:`Breakage ${"approved"===v.decision?"approved":"rejected"} successfully.`}),a(),s(!1)}catch(e){console.error("Error processing approval:",e),j({title:"Error",description:"Failed to process approval. Please try again.",variant:"destructive"})}finally{x(!1)}}},w=l?.approval_status==="pending";return(0,t.jsx)(P.cj,{open:e,onOpenChange:s,children:(0,t.jsxs)(P.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,t.jsxs)(P.Fm,{className:"flex-shrink-0",children:[(0,t.jsx)(P.qp,{children:"Approve Breakage Report"}),(0,t.jsx)(P.Qs,{children:l?`Review and approve breakage ${l.breakage_number}`:"Review breakage report"})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:[!w&&(0,t.jsx)(n.Zp,{className:"border-yellow-200 bg-yellow-50",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 text-yellow-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-yellow-800",children:"Already Processed"}),(0,t.jsxs)("p",{className:"text-sm text-yellow-700",children:["This breakage report has already been ",l?.approval_status,". Only pending reports can be reviewed."]})]})]})})}),l&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,t.jsx)(c.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Breakage Summary"})]}),(0,t.jsx)(n.BT,{children:"Review the breakage report details before making a decision"})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Breakage Number"}),(0,t.jsx)("p",{className:"text-sm text-gray-700",children:l.breakage_number})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Current Status"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(p.E,{variant:"pending"===l.status?"secondary":"default",children:l.status}),(0,t.jsx)(p.E,{variant:"approved"===l.approval_status?"default":"rejected"===l.approval_status?"destructive":"secondary",children:l.approval_status})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Date Reported"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-700",children:[(0,t.jsx)(ea.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:(0,h.GP)(new Date(l.created_at),"MMM dd, yyyy 'at' HH:mm")})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"Reported By"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-700",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[l.reporter?.first_name," ",l.reporter?.last_name]})]})]}),l.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)(L.J,{className:"text-sm font-medium",children:"General Notes"}),(0,t.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded",children:l.notes})]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("h4",{className:"font-medium text-gray-900 mb-3",children:["Broken Items (",l.items.length,")"]}),(0,t.jsx)("div",{className:"space-y-3",children:l.items.map((e,s)=>(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.product_name||e.assignableItem?.product_name||e.product?.name||"Product"}),(e.variant_name||e.assignableItem?.variant_name||e.variant)&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Variant: ",e.variant_name||e.assignableItem?.variant_name||e.variant?.name]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["SKU: ",e.product?.sku]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Qty: ",e.quantity]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.product?.unit_of_measurement})]})]}),(0,t.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Cause: "}),(0,t.jsx)("span",{className:"text-gray-700",children:e.cause.replace(/_/g," ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Replacement: "}),(0,t.jsx)("span",{className:e.replacement_requested?"text-green-600":"text-gray-500",children:e.replacement_requested?"Requested":"Not requested"})]})]}),e.notes&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:"Notes: "}),(0,t.jsx)("span",{className:"text-sm text-gray-700",children:e.notes})]})]},s))})]})]})]}),w&&(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-lg",children:"Approval Decision"}),(0,t.jsx)(n.BT,{children:"Make your decision and provide feedback"})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Decision *"}),(0,t.jsxs)(g.l6,{value:v.decision,onValueChange:e=>y(s=>({...s,decision:e,rejection_reason:"approved"===e?void 0:s.rejection_reason})),children:[(0,t.jsx)(g.bq,{className:N.decision?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select your decision"})}),(0,t.jsxs)(g.gC,{children:[(0,t.jsx)(g.eb,{value:"approved",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.A,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)("span",{children:"Approve"})]})}),(0,t.jsx)(g.eb,{value:"rejected",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 text-red-600"}),(0,t.jsx)("span",{children:"Reject"})]})})]})]}),N.decision&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:N.decision})]}),"rejected"===v.decision&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L.J,{children:"Rejection Reason *"}),(0,t.jsxs)(g.l6,{value:v.rejection_reason||"",onValueChange:e=>y(s=>({...s,rejection_reason:e})),children:[(0,t.jsx)(g.bq,{className:N.rejection_reason?"border-red-500":"",children:(0,t.jsx)(g.yv,{placeholder:"Select reason for rejection"})}),(0,t.jsx)(g.gC,{children:er.map(e=>(0,t.jsx)(g.eb,{value:e,children:ei[e]},e))})]}),N.rejection_reason&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:N.rejection_reason})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(L.J,{children:["approved"===v.decision?"Approval Notes":"Notes"," *"]}),(0,t.jsx)(W.T,{placeholder:"approved"===v.decision?"Add any approval notes or instructions...":"rejected"===v.decision?"Explain the reason for rejection and any required actions...":"Add your notes about this breakage report...",value:v.approval_notes,onChange:e=>y(s=>({...s,approval_notes:e.target.value})),rows:4,className:N.approval_notes?"border-red-500":""}),N.approval_notes&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:N.approval_notes})]})]})]})]}),(0,t.jsx)(P.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,t.jsxs)("div",{className:"flex justify-between w-full",children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),w&&(0,t.jsxs)(u.$,{onClick:_,disabled:d||!v.decision,className:(0,V.cn)("min-w-[120px]","approved"===v.decision?"bg-green-600 hover:bg-green-700":"rejected"===v.decision?"bg-red-600 hover:bg-red-700":"bg-[#1E2764] hover:bg-[#1E2764]/90"),children:[d?(0,t.jsx)(D.A,{className:"h-4 w-4 mr-2 animate-spin"}):"approved"===v.decision?(0,t.jsx)(o.A,{className:"h-4 w-4 mr-2"}):"rejected"===v.decision?(0,t.jsx)(m.A,{className:"h-4 w-4 mr-2"}):(0,t.jsx)(et.A,{className:"h-4 w-4 mr-2"}),"approved"===v.decision?"Approve":"rejected"===v.decision?"Reject":"Submit Decision"]})]})})]})})}function el(){let[e,s]=(0,r.useState)([]),[a,n]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[p,u]=(0,r.useState)(null),[j,g]=(0,r.useState)(!1),[v,y]=(0,r.useState)(null),[N,b]=(0,r.useState)(!1),[f,_]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),[C,A]=(0,r.useState)(null),[q,E]=(0,r.useState)(!0),[S,B]=(0,r.useState)(""),[$,P]=(0,r.useState)(null),[I,D]=(0,r.useState)(1),[Z,T]=(0,r.useState)(10),{toast:L}=(0,i.dj)(),W=async()=>{E(!0);try{let e=await (0,J.wT)();s(e.breakages.data)}catch(e){console.error("Error fetching breakages:",e),L({title:"Error",description:"Failed to fetch breakages. Please try again.",variant:"destructive"})}finally{E(!1)}},O=e.filter(e=>e.breakage_number.toLowerCase().includes(S.toLowerCase())||(e.reporter?.first_name||"").toLowerCase().includes(S.toLowerCase())||(e.reporter?.last_name||"").toLowerCase().includes(S.toLowerCase())||e.status.toLowerCase().includes(S.toLowerCase())||e.approval_status.toLowerCase().includes(S.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(S.toLowerCase())||e.items.some(e=>e.cause.toLowerCase().includes(S.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(S.toLowerCase()))),F=Math.ceil(O.length/Z),U=(I-1)*Z,V=O.slice(U,U+Z),H=e=>{u(e),h(!0)},Q=e=>{y(e),g(!0)},X=e=>{_(e),b(!0)},K=e=>{A(e),k(!0)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Breakages"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Track and manage product breakages and replacement requests"})]}),(0,t.jsx)(x,{breakages:e,loading:q}),(0,t.jsx)(R,{breakages:V,loading:q,onViewBreakage:e=>{n(e),c(!0)},onEditBreakage:H,onDeleteBreakage:Q,onApproveBreakage:X,onCreateDispatch:K,search:S,onSearchChange:B,currentPage:I,totalPages:F,rowsPerPage:Z,onPageChange:D,onRowsPerPageChange:T,totalItems:O.length,onRefresh:W,onCreateNew:()=>o(!0)}),(0,t.jsx)(M,{open:l,onOpenChange:c,breakage:a,onClose:()=>{c(!1),n(null)},onEditBreakage:H,onDeleteBreakage:Q,onApproveBreakage:X,onCreateDispatch:K}),(0,t.jsx)(G,{open:d,onOpenChange:o,onSuccess:()=>{o(!1),W(),L({title:"Success",description:"Breakage reported successfully."})}}),(0,t.jsx)(z,{open:m,onOpenChange:h,onSuccess:()=>{h(!1),u(null),W(),L({title:"Success",description:"Breakage updated successfully."})},breakage:p}),(0,t.jsx)(es,{open:j,onOpenChange:g,onSuccess:()=>{g(!1),y(null),W()},breakage:v}),(0,t.jsx)(en,{open:N,onOpenChange:b,onSuccess:()=>{b(!1),_(null),W()},breakage:f}),(0,t.jsx)(Y,{open:w,onOpenChange:k,onSuccess:()=>{k(!1),A(null),W()},breakage:C})]})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31158:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},33873:e=>{"use strict";e.exports=require("path")},35071:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},39390:(e,s,a)=>{"use strict";a.d(s,{J:()=>d});var t=a(60687),r=a(43210),i=a(78148),n=a(24224),l=a(96241);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(i.b,{ref:a,className:(0,l.cn)(c(),e),...s}));d.displayName=i.b.displayName},40228:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},50614:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>i});var t=a(37413),r=a(56254);function i({children:e}){return(0,t.jsx)(r.e,{children:e})}},59821:(e,s,a)=>{"use strict";a.d(s,{E:()=>l});var t=a(60687),r=a(24224),i=a(96241);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...a}){return(0,t.jsx)("div",{className:(0,i.cn)(n({variant:s}),e),...a})}},62103:(e,s,a)=>{"use strict";a.d(s,{Id:()=>c,KZ:()=>d,PK:()=>i,getAssignableItems:()=>m,gh:()=>o,q:()=>l,wT:()=>r,zX:()=>n});var t=a(29226);async function r(e){let s=e?"?"+Object.entries(e).filter(([e,s])=>null!=s).map(([e,s])=>`${encodeURIComponent(e)}=${encodeURIComponent(s)}`).join("&"):"";return await (0,t.Ay)(`/whs/breakages${s}`,"GET",void 0,!0)}async function i(e){return await (0,t.Ay)("/whs/breakages","POST",e,!0)}async function n(e){return(await (0,t.Ay)(`/whs/breakages/${e}`,"GET",void 0,!0)).breakage}async function l(e,s){return await (0,t.Ay)(`/whs/breakages/${e}/approve`,"PATCH",s,!0)}async function c(e,s){return await (0,t.Ay)(`/whs/breakages/${e}`,"PUT",{status:s},!0)}async function d(e,s){return await (0,t.Ay)(`/whs/breakages/${e}`,"PUT",s,!0)}async function o(e){return await (0,t.Ay)(`/whs/breakages/${e}`,"DELETE",void 0,!0)}async function m(){return await (0,t.Ay)("/whs/breakages/my-assignable-items","GET",void 0,!0)}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69184:(e,s,a)=>{Promise.resolve().then(a.bind(a,8902))},71357:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>d});var t=a(65239),r=a(48088),i=a(88170),n=a.n(i),l=a(30893),c={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);a.d(s,c);let d={children:["",{children:["breakages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,2413)),"/Users/inchwara/sawela/app/breakages/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,50614)),"/Users/inchwara/sawela/app/breakages/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,58014)),"/Users/inchwara/sawela/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["/Users/inchwara/sawela/app/breakages/page.tsx"],m={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/breakages/page",pathname:"/breakages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},90103:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(62688).A)("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]])}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[7719,6447,3399,5814,7676,1126,4097,5902,5650,7895,4248,1158,6173,1231,8369],()=>a(71357));module.exports=t})();