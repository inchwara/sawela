(()=>{var e={};e.id=1962,e.ids=[1962],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5983:(e,s,t)=>{"use strict";t.d(s,{RequisitionsPage:()=>a});let a=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call RequisitionsPage() from the server but RequisitionsPage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/inchwara/sawela/app/requisitions/components/RequisitionsPage.tsx","RequisitionsPage")},7803:(e,s,t)=>{"use strict";t.d(s,{PermissionGuard:()=>c});var a=t(60687),i=t(17073),r=t(39642),n=t(41862),l=t(72840);function c({permissions:e,requireAll:s=!1,children:t,fallback:c,loading:d,hideOnDenied:o=!1}){let{hasPermission:x,hasAnyPermission:m,hasAllPermissions:h}=(0,i.S)(),{isLoading:u}=(0,r.A)();if(u)return d||(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)(n.A,{className:"h-8 w-8 animate-spin"})});let p=Array.isArray(e)?e:[e],j=!1;return(s?h(p):m(p))?(0,a.jsx)(a.Fragment,{children:t}):o?null:(0,a.jsx)(a.Fragment,{children:c||(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 space-y-4",children:[(0,a.jsx)(l.A,{className:"h-12 w-12 text-gray-400"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-700",children:"Access Denied"}),(0,a.jsxs)("p",{className:"text-gray-500 text-center max-w-md",children:["You do not have permission to view this content.",(0,a.jsx)("br",{}),"Please contact your administrator to request access."]})]})})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15361:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(37413),i=t(5983);function r(){return(0,a.jsx)(i.RequisitionsPage,{})}},17073:(e,s,t)=>{"use strict";t.d(s,{S:()=>i});var a=t(39642);function i(){let{userProfile:e,hasPermission:s}=(0,a.A)(),t=e=>s(e),i=()=>t("can_manage_system"),r=()=>t("can_manage_company");return{hasPermission:t,hasAnyPermission:e=>e.some(e=>t(e)),hasAllPermissions:e=>e.every(e=>t(e)),isSystemAdmin:i,isCompanyAdmin:r,isAdmin:()=>i()||r(),userProfile:e}}},17869:(e,s,t)=>{"use strict";t.d(s,{RequisitionsPage:()=>ec});var a=t(60687),i=t(43210),r=t(71702),n=t(55192),l=t(6727),c=t(48730),d=t(5336),o=t(35071),x=t(71463);function m({requisitions:e,loading:s}){let[t,r]=(0,i.useState)({totalRequisitions:0,pendingRequisitions:0,approvedRequisitions:0,rejectedRequisitions:0,totalItems:0});return s?(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-4",children:[1,2,3,4].map(e=>(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(x.E,{className:"h-4 w-32"}),(0,a.jsx)(x.E,{className:"h-4 w-4 rounded-full"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)(x.E,{className:"h-8 w-24 mb-2"}),(0,a.jsx)(x.E,{className:"h-4 w-32"})]})]},e))}):(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Total Requisitions"}),(0,a.jsx)(l.A,{className:"h-4 w-4 text-[#E30040]"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.totalRequisitions}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[t.totalItems," items total"]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Pending Approval"}),(0,a.jsx)(c.A,{className:"h-4 w-4 text-[#E30040]"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.pendingRequisitions}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting approval"})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Approved"}),(0,a.jsx)(d.A,{className:"h-4 w-4 text-[#E30040]"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.approvedRequisitions}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Ready for fulfillment"})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:"Rejected"}),(0,a.jsx)(o.A,{className:"h-4 w-4 text-[#E30040]"})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.rejectedRequisitions}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Requires attention"})]})]})]})}var h=t(85650),u=t(59821),p=t(24934),j=t(68988),v=t(63974),g=t(55629),y=t(96752),N=t(99270),f=t(96474),b=t(31158),w=t(78122),q=t(47033),_=t(14952),C=t(93661),A=t(13861),S=t(19080),R=t(63143),k=t(88233);function E({requisitions:e,loading:s,onViewRequisition:t,onEditRequisition:i,onDeleteRequisition:r,onApproveRequisition:n,onCreateDispatch:l,search:c,onSearchChange:d,currentPage:o,totalPages:x,rowsPerPage:m,onPageChange:g,onRowsPerPageChange:C,totalItems:A,onRefresh:S,onCreateNew:R}){let k=e=>{switch(e.toLowerCase()){case"pending":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"approved":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Approved"});case"rejected":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:"Rejected"});case"fulfilled":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Fulfilled"});case"dispatched":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Dispatched"});case"cancelled":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Cancelled"});default:return(0,a.jsx)(u.E,{variant:"secondary",children:e})}},E=e=>{switch(e.toLowerCase()){case"pending":return(0,a.jsx)(u.E,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:"Pending Approval"});case"approved":return(0,a.jsx)(u.E,{variant:"outline",className:"border-green-500 text-green-700",children:"Approved"});case"rejected":return(0,a.jsx)(u.E,{variant:"outline",className:"border-red-500 text-red-700",children:"Rejected"});default:return(0,a.jsx)(u.E,{variant:"outline",children:e})}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex space-x-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500"}),(0,a.jsx)(j.p,{className:"pl-8 max-w-sm",placeholder:"Search requisitions...",value:c,onChange:e=>d(e.target.value)})]})}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(p.$,{size:"sm",onClick:R,className:"bg-primary text-white hover:bg-primary/90",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Create Requisition"]}),(0,a.jsxs)(p.$,{size:"sm",className:"bg-primary text-white hover:bg-primary/90",children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Export"]}),(0,a.jsxs)(p.$,{size:"sm",className:"bg-primary text-white hover:bg-primary/90",onClick:S,children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),(0,a.jsx)("div",{className:"rounded-md border bg-white",children:(0,a.jsxs)(y.XI,{children:[(0,a.jsx)(y.A0,{children:(0,a.jsxs)(y.Hj,{children:[(0,a.jsx)(y.nd,{className:"font-semibold",children:"Requisition #"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Requester"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Items"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Status"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Approval Status"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Approver"}),(0,a.jsx)(y.nd,{className:"font-semibold",children:"Created"}),(0,a.jsx)(y.nd,{className:"text-right font-semibold",children:"Actions"})]})}),(0,a.jsx)(y.BF,{children:s?(0,a.jsx)(y.Hj,{children:(0,a.jsx)(y.nA,{colSpan:8,className:"h-24 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"}),(0,a.jsx)("span",{children:"Loading requisitions..."})]})})}):0===e.length?(0,a.jsx)(y.Hj,{children:(0,a.jsx)(y.nA,{colSpan:8,className:"h-24 text-center",children:(0,a.jsxs)("div",{className:"text-gray-500",children:[(0,a.jsx)("p",{className:"font-semibold",children:"No requisitions found"}),(0,a.jsx)("p",{className:"text-sm",children:"Create your first requisition to get started"})]})})}):e.map(e=>(0,a.jsxs)(y.Hj,{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>t(e),children:[(0,a.jsx)(y.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-primary",children:e.requisition_number}),e.notes&&(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1 truncate max-w-[150px]",children:e.notes})]})}),(0,a.jsx)(y.nA,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.requester.first_name," ",e.requester.last_name]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.requester.email})]})}),(0,a.jsx)(y.nA,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.items.length," item",1!==e.items.length?"s":""]}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Total Qty: ",e.items.reduce((e,s)=>e+s.quantity,0)]})]})}),(0,a.jsx)(y.nA,{children:k(e.status)}),(0,a.jsx)(y.nA,{children:E(e.approval_status)}),(0,a.jsx)(y.nA,{children:e.approver?(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.approver.first_name," ",e.approver.last_name]}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.approver.email})]}):(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Not yet assigned"})}),(0,a.jsx)(y.nA,{children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,h.GP)(new Date(e.created_at),"MMM dd, yyyy"),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,h.GP)(new Date(e.created_at),"HH:mm")})]})}),(0,a.jsx)(y.nA,{className:"text-right",onClick:e=>e.stopPropagation(),children:(0,a.jsx)(P,{requisition:e,onView:()=>t(e),onEdit:()=>i(e),onDelete:()=>r(e),onApprove:()=>n(e),onCreateDispatch:()=>l(e)})})]},e.id))})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Rows per page"}),(0,a.jsxs)(v.l6,{value:m.toString(),onValueChange:e=>{C(Number(e)),g(1)},children:[(0,a.jsx)(v.bq,{className:"h-8 w-[70px]",children:(0,a.jsx)(v.yv,{placeholder:m})}),(0,a.jsx)(v.gC,{side:"top",children:[5,10,20,30,40,50].map(e=>(0,a.jsx)(v.eb,{value:e.toString(),children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(p.$,{size:"sm",onClick:()=>g(Math.max(o-1,1)),disabled:1===o,className:"bg-primary text-white hover:bg-primary/90 disabled:opacity-50",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("div",{className:"flex items-center justify-center text-sm font-medium",children:["Page ",o," of ",x||1]}),(0,a.jsxs)(p.$,{size:"sm",onClick:()=>g(Math.min(o+1,x||1)),disabled:o===x||0===x,className:"bg-primary text-white hover:bg-primary/90 disabled:opacity-50",children:["Next",(0,a.jsx)(_.A,{className:"h-4 w-4"})]})]})]})]})})}function P({requisition:e,onView:s,onEdit:t,onDelete:i,onApprove:r,onCreateDispatch:n}){let l="pending"===e.status&&"pending"===e.approval_status,c="pending"===e.status&&"pending"===e.approval_status,o="pending"===e.approval_status,x="approved"===e.approval_status&&!e.dispatch_id;return(0,a.jsxs)(g.rI,{children:[(0,a.jsx)(g.ty,{asChild:!0,children:(0,a.jsx)(p.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(g.SQ,{align:"end",children:[(0,a.jsx)(g.lp,{children:"Actions"}),(0,a.jsxs)(g._2,{onClick:s,children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"})," View Details"]}),o&&(0,a.jsxs)(g._2,{onClick:r,className:"text-green-600 focus:text-green-600",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"})," Approve Requisition"]}),x&&(0,a.jsxs)(g._2,{onClick:n,className:"text-blue-600 focus:text-blue-600",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"})," Create Dispatch"]}),l&&(0,a.jsxs)(g._2,{onClick:t,children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2"})," Edit Requisition"]}),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.mB,{}),(0,a.jsxs)(g._2,{onClick:i,className:"text-red-600 focus:text-red-600",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"})," Delete Requisition"]})]})]})]})}var $=t(92241),Z=t(70373),F=t(58869),D=t(10022),O=t(39390),T=t(15616),B=t(93613),L=t(41862),I=t(29226);async function J(e){return await (0,I.Ay)("/whs/requisitions","POST",e,!0)}async function W(e){let s=e?"?"+Object.entries(e).filter(([e,s])=>null!=s).map(([e,s])=>`${encodeURIComponent(e)}=${encodeURIComponent(s)}`).join("&"):"";return await (0,I.Ay)(`/whs/requisitions${s}`,"GET",void 0,!0)}async function M(e,s){return await (0,I.Ay)(`/whs/requisitions/${e}/approve`,"PATCH",s,!0)}async function U(e,s){return await (0,I.Ay)(`/whs/requisitions/${e}`,"PUT",s,!0)}async function z(e,s){return await (0,I.Ay)(`/whs/requisitions/${e}`,"PATCH",s,!0)}async function Q(e){return await (0,I.Ay)(`/whs/requisitions/${e}`,"DELETE",void 0,!0)}function V({open:e,onOpenChange:s,onSuccess:t,requisition:l}){let[c,d]=(0,i.useState)(!1),[o,x]=(0,i.useState)([]),[m,h]=(0,i.useState)([]),[g,y]=(0,i.useState)(""),{toast:b}=(0,r.dj)(),[w,q]=(0,i.useState)({approver_id:"",notes:"",items:[]}),[_,C]=(0,i.useState)({}),A=o.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(g.toLowerCase())),R=(e,s)=>{let t=w.items.findIndex(t=>t.product_id===e.id&&t.variant_id===s?.id);if(t>=0){let e=[...w.items];e[t].quantity+=1,q({...w,items:e})}else{let t={product_id:e.id,variant_id:s?.id,quantity:1,notes:"",product:e,variant:s};q({...w,items:[...w.items,t]})}y("")},E=(e,s)=>{let t=[...w.items];t[e].quantity=Math.max(0,s),q({...w,items:t})},P=(e,s)=>{let t=[...w.items];t[e].notes=s,q({...w,items:t})},Z=e=>{let s=w.items.filter((s,t)=>t!==e);q({...w,items:s})},F=()=>{let e={};return w.approver_id||(e.approver_id="Approver is required"),0===w.items.length&&(e.items="At least one item is required"),w.items.forEach((s,t)=>{s.quantity<=0&&(e[`item_${t}_quantity`]="Quantity must be greater than 0")}),C(e),0===Object.keys(e).length},D=async e=>{if(e.preventDefault(),F()&&l){d(!0);try{let e={notes:w.notes||void 0,items:w.items.map(e=>({id:e.id,product_id:e.product_id,variant_id:e.variant_id||void 0,quantity:e.quantity,notes:e.notes||void 0}))};console.log("Updating requisition with payload:",e);let a=await U(l.id,e);console.log("Update response:",a),b({title:"Success",description:"Requisition updated successfully"}),t(),s(!1)}catch(e){console.error("Update error:",e),b({title:"Error",description:e.message||"Failed to update requisition",variant:"destructive"})}finally{d(!1)}}};return(l?.status!=="pending"||l?.approval_status!=="pending")&&l?(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl overflow-y-auto",children:[(0,a.jsxs)($.Fm,{children:[(0,a.jsx)($.qp,{children:"Edit Requisition"}),(0,a.jsxs)($.Qs,{children:["Cannot edit requisition ",l.requisition_number]})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(B.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["This requisition cannot be edited because it has already been ",l.status,"."]})]})}),(0,a.jsx)($.XW,{children:(0,a.jsx)(p.$,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Close"})})]})}):(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,a.jsxs)($.Fm,{children:[(0,a.jsx)($.qp,{children:"Edit Requisition"}),(0,a.jsx)($.Qs,{children:l?`Edit requisition ${l.requisition_number}`:"Edit requisition details"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto py-4",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Approver"}),(0,a.jsx)(n.BT,{children:"Select the user who will approve this requisition"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"approver_id",children:"Approver *"}),(0,a.jsxs)(v.l6,{value:w.approver_id,onValueChange:e=>q({...w,approver_id:e}),children:[(0,a.jsx)(v.bq,{className:_.approver_id?"border-red-500":"",children:(0,a.jsx)(v.yv,{placeholder:"Select approver"})}),(0,a.jsx)(v.gC,{children:m.map(e=>(0,a.jsx)(v.eb,{value:e.id,children:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]})})},e.id))})]}),_.approver_id&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:_.approver_id})]})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Add Products"}),(0,a.jsx)(n.BT,{children:"Search and select products to include in this requisition"})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(j.p,{placeholder:"Search products by name or SKU...",value:g,onChange:e=>y(e.target.value),className:"pl-10"})]}),g&&(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto border rounded-md",children:A.length>0?(0,a.jsx)("div",{className:"divide-y",children:A.slice(0,10).map(e=>(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["SKU: ",e.sku]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.stock_quantity," ",e.unit_of_measurement]}),e.stock_quantity>0&&e.stock_quantity<=10&&(0,a.jsx)(u.E,{variant:"secondary",className:"text-xs bg-yellow-100 text-yellow-800",children:"Low Stock"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:e.has_variations&&e.variants?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(v.l6,{onValueChange:s=>{let t=e.variants?.find(e=>e.id===s);t&&R(e,t)},children:[(0,a.jsx)(v.bq,{className:"w-40",children:(0,a.jsx)(v.yv,{placeholder:"Select variant"})}),(0,a.jsx)(v.gC,{children:e.variants.map(e=>(0,a.jsx)(v.eb,{value:e.id,disabled:e.stock_quantity<=0,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["Stock: ",e.stock_quantity]})]})},e.id))})]}),(0,a.jsxs)(p.$,{size:"sm",onClick:()=>R(e),disabled:e.stock_quantity<=0,className:"bg-primary hover:bg-primary/90",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"Add"]})]}):(0,a.jsxs)(p.$,{size:"sm",onClick:()=>R(e),disabled:e.stock_quantity<=0,className:"bg-[#E30040] hover:bg-[#E30040]/90",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"Add"]})})]})},e.id))}):(0,a.jsxs)("div",{className:"p-4 text-center text-gray-500 text-sm",children:['No products found matching "',g,'"']})}),_.items&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-600 text-sm",children:[(0,a.jsx)(B.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:_.items})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"text-lg",children:["Selected Items (",w.items.length,")"]}),_.items&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:_.items})]}),(0,a.jsx)(n.Wu,{children:0===w.items.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No items selected yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Search and add products above"})]}):(0,a.jsx)("div",{className:"space-y-4",children:w.items.map((e,s)=>{let t=e.product,i=e.variant,r=i?i.stock_quantity:t?.stock_quantity||0;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:t?.name}),i&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Variant: ",i.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Available: ",r," ",t?.unit_of_measurement]})]}),(0,a.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>Z(s),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(k.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Quantity *"}),(0,a.jsx)(j.p,{type:"number",min:"1",value:e.quantity,onChange:e=>E(s,parseInt(e.target.value)||1),className:_[`item_${s}_quantity`]?"border-red-500":""}),_[`item_${s}_quantity`]&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:_[`item_${s}_quantity`]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Item Notes"}),(0,a.jsx)(j.p,{placeholder:"Optional notes for this item...",value:e.notes||"",onChange:e=>P(s,e.target.value)})]})]})]},`${e.product_id}-${e.variant_id||"no-variant"}-${s}`)})})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-lg",children:"Additional Notes"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)(T.T,{placeholder:"Enter any additional notes for this requisition...",value:w.notes,onChange:e=>q({...w,notes:e.target.value}),rows:3})})]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t mt-auto",children:[(0,a.jsx)(p.$,{type:"button",variant:"ghost",onClick:()=>s(!1),disabled:c,children:"Cancel"}),(0,a.jsx)(p.$,{type:"submit",disabled:c||0===w.items.length,className:"bg-[#E30040] hover:bg-[#E30040]/90",onClick:D,children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Requisition"})]})]})})}t(56338),t(71420);var H=t(95033),G=t(43649);function K({open:e,onOpenChange:s,requisition:t,onSuccess:n}){let[l,c]=(0,i.useState)(!1),{toast:d}=(0,r.dj)(),o=async()=>{if(t){c(!0);try{await Q(t.id),d({title:"Success",description:`Requisition ${t.requisition_number} has been deleted successfully.`}),n(),s(!1)}catch(e){console.error("Delete error:",e),d({title:"Error",description:e.message||"Failed to delete requisition",variant:"destructive"})}finally{c(!1)}}};return(t?.status!=="pending"||t?.approval_status!=="pending")&&t?(0,a.jsx)(H.Lt,{open:e,onOpenChange:s,children:(0,a.jsxs)(H.EO,{children:[(0,a.jsxs)(H.wd,{children:[(0,a.jsxs)(H.r7,{className:"flex items-center space-x-2",children:[(0,a.jsx)(G.A,{className:"h-5 w-5 text-red-500"}),(0,a.jsx)("span",{children:"Cannot Delete Requisition"})]}),(0,a.jsxs)(H.$v,{children:["Requisition ",t.requisition_number," cannot be deleted because it has already been ",t.status,". Only pending requisitions can be deleted."]})]}),(0,a.jsx)(H.ck,{children:(0,a.jsx)(H.Zr,{children:"Close"})})]})}):(0,a.jsx)(H.Lt,{open:e,onOpenChange:s,children:(0,a.jsxs)(H.EO,{children:[(0,a.jsxs)(H.wd,{children:[(0,a.jsxs)(H.r7,{className:"flex items-center space-x-2",children:[(0,a.jsx)(G.A,{className:"h-5 w-5 text-red-500"}),(0,a.jsx)("span",{children:"Delete Requisition"})]}),(0,a.jsxs)(H.$v,{children:["Are you sure you want to delete requisition"," ",(0,a.jsx)("span",{className:"font-semibold",children:t?.requisition_number}),"? This action cannot be undone."]})]}),(0,a.jsxs)(H.ck,{children:[(0,a.jsx)(H.Zr,{disabled:l,children:"Cancel"}),(0,a.jsx)(H.Rx,{onClick:o,disabled:l,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Requisition"})]})]})})}function X({open:e,onOpenChange:s,onSuccess:t,requisition:c,currentUserId:o}){let[x,m]=(0,i.useState)(!1),[j,v]=(0,i.useState)("Approved"),{toast:g}=(0,r.dj)(),y=async()=>{if(c){m(!0);try{let e={approver_id:o||c.approver_id||"",approval_status:"approved",notes:j||"Approved"};console.log("Approving requisition with payload:",e);let a=await M(c.id,e);console.log("Approve response:",a),g({title:"Success",description:`Requisition ${c.requisition_number} has been approved successfully.`}),t(),s(!1)}catch(e){console.error("Approve error:",e),g({title:"Error",description:e.message||"Failed to approve requisition",variant:"destructive"})}finally{m(!1)}}};return c?.approval_status!=="pending"&&c?(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,a.jsxs)($.Fm,{children:[(0,a.jsx)($.qp,{children:"Cannot Approve Requisition"}),(0,a.jsxs)($.Qs,{children:["Requisition ",c.requisition_number," cannot be approved"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto py-4",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(d.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["This requisition has already been ",c.approval_status,". Only pending requisitions can be approved."]})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between px-6 py-4 border-t mt-auto",children:(0,a.jsx)(p.$,{type:"button",variant:"ghost",onClick:()=>s(!1),children:"Close"})})]})}):(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,a.jsxs)($.Fm,{children:[(0,a.jsx)($.qp,{children:"Approve Requisition"}),(0,a.jsx)($.Qs,{children:c?`Approve requisition ${c.requisition_number}`:"Approve requisition"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto py-4",children:(0,a.jsxs)("div",{className:"space-y-6",children:[c&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Requisition Summary"})]})}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Requisition Number"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:c.requisition_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Created Date"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:(0,h.GP)(new Date(c.created_at),"MMM dd, yyyy 'at' HH:mm")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Requester"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 mt-1",children:[(0,a.jsx)(Z.eu,{className:"h-8 w-8",children:(0,a.jsxs)(Z.q5,{className:"bg-primary/10 text-primary text-sm",children:[c.requester.first_name[0],c.requester.last_name[0]]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:[c.requester.first_name," ",c.requester.last_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:c.requester.email})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Items"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[c.items.length," item",1!==c.items.length?"s":""," â€¢ Total Qty: ",c.items.reduce((e,s)=>e+s.quantity,0)]})]}),c.notes&&(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Request Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md mt-1",children:c.notes})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Current Status:"}),(0,a.jsx)(u.E,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:"Pending Approval"})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Approval Notes"}),(0,a.jsx)(n.BT,{children:"Add any notes or comments regarding this approval"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(T.T,{id:"notes",placeholder:"Enter approval notes (optional)...",value:j,onChange:e=>v(e.target.value),rows:4}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:'Default: "Approved" - You can add specific comments if needed'})]})})]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t mt-auto",children:[(0,a.jsx)(p.$,{type:"button",variant:"ghost",onClick:()=>s(!1),disabled:x,children:"Cancel"}),(0,a.jsx)(p.$,{type:"button",disabled:x,className:"bg-green-600 hover:bg-green-700",onClick:y,children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Approving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Approve Requisition"]})})]})]})})}function Y({open:e,onOpenChange:s,requisition:t,onClose:c,onRefresh:o,onDeleteRequisition:x,onCreateDispatch:m}){let[j,v]=(0,i.useState)(t),[g,y]=(0,i.useState)(!1),[N,f]=(0,i.useState)(!1),[b,w]=(0,i.useState)(!1),[q,_]=(0,i.useState)(!1),{toast:C}=(0,r.dj)(),A=j?.status==="pending"&&j?.approval_status==="pending",E=j?.status==="pending"&&j?.approval_status==="pending",P=j?.approval_status==="pending",O=j?.approval_status==="approved"&&!j?.dispatch_id;return(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,a.jsxs)($.Fm,{className:"flex-shrink-0",children:[(0,a.jsx)($.qp,{children:"Requisition Details"}),(0,a.jsx)($.Qs,{children:j?`Requisition ${j.requisition_number}`:"View requisition details"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto py-4 space-y-6",children:j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:j.requisition_number})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e.toLowerCase()){case"pending":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"approved":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Approved"});case"rejected":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:"Rejected"});case"fulfilled":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Fulfilled"});case"dispatched":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Dispatched"});case"cancelled":return(0,a.jsx)(u.E,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Cancelled"});default:return(0,a.jsx)(u.E,{variant:"secondary",children:e})}})(j.status),(e=>{switch(e.toLowerCase()){case"pending":return(0,a.jsx)(u.E,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:"Pending Approval"});case"approved":return(0,a.jsx)(u.E,{variant:"outline",className:"border-green-500 text-green-700",children:"Approved"});case"rejected":return(0,a.jsx)(u.E,{variant:"outline",className:"border-red-500 text-red-700",children:"Rejected"});default:return(0,a.jsx)(u.E,{variant:"outline",children:e})}})(j.approval_status)]})]}),(0,a.jsxs)(n.BT,{children:["Created on ",(0,h.GP)(new Date(j.created_at),"MMMM dd, yyyy 'at' HH:mm")]})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,a.jsx)(F.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Requester"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(Z.eu,{className:"h-8 w-8",children:(0,a.jsxs)(Z.q5,{className:"bg-primary/10 text-primary text-sm",children:[j.requester.first_name[0],j.requester.last_name[0]]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:[j.requester.first_name," ",j.requester.last_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:j.requester.email})]})]})]}),j.approver&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Approver"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(Z.eu,{className:"h-8 w-8",children:(0,a.jsxs)(Z.q5,{className:"bg-green-100 text-green-800 text-sm",children:[j.approver.first_name[0],j.approver.last_name[0]]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:[j.approver.first_name," ",j.approver.last_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:j.approver.email})]})]})]})]}),j.notes&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("h4",{className:"font-semibold flex items-center space-x-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Notes"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md",children:j.notes})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(S.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Requisition Items"})]}),(0,a.jsxs)(n.BT,{children:[j.items?.length||0," products in this requisition"]})]}),(0,a.jsx)(n.Wu,{children:j.items&&j.items.length>0?(0,a.jsx)("div",{className:"space-y-4",children:j.items.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(S.A,{className:"h-6 w-6 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.product.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[(0,a.jsxs)("span",{children:["SKU: ",e.product.sku]}),e.variant&&(0,a.jsxs)("span",{children:["Variant: ",e.variant.name]}),(0,a.jsxs)("span",{children:["Category: ",e.product.category]})]}),e.notes&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.notes})]})]})}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"font-semibold",children:["Qty: ",e.quantity]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.product.unit_of_measurement})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No items in this requisition"})]})})]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(l.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No requisition selected"})]})}),(0,a.jsx)($.XW,{className:"flex-shrink-0 border-t pt-4 mt-auto",children:(0,a.jsxs)("div",{className:"flex justify-between w-full",children:[(0,a.jsx)(p.$,{variant:"outline",onClick:()=>s(!1),children:"Close"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[O&&(0,a.jsxs)(p.$,{onClick:()=>{m&&j&&m(j)},className:"bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-1"}),"Create Dispatch"]}),P&&(0,a.jsxs)(p.$,{onClick:()=>_(!0),className:"bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Approve"]}),A&&(0,a.jsxs)(p.$,{onClick:()=>f(!0),className:"bg-primary hover:bg-primary/90",children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-1"}),"Edit"]}),E&&(0,a.jsxs)(p.$,{variant:"destructive",onClick:()=>w(!0),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})}),(0,a.jsx)(V,{open:N,onOpenChange:f,onSuccess:()=>{o&&o(),f(!1)},requisition:j}),(0,a.jsx)(K,{open:b,onOpenChange:w,onSuccess:()=>{o&&o(),w(!1),s(!1)},requisition:j}),(0,a.jsx)(X,{open:q,onOpenChange:_,onSuccess:()=>{o&&o(),_(!1)},requisition:j})]})})}var ee=t(14719);function es({open:e,onOpenChange:s,onSuccess:t}){let[l,c]=(0,i.useState)(!1),[d,o]=(0,i.useState)([]),[x,m]=(0,i.useState)([]),[h,g]=(0,i.useState)(""),{toast:y}=(0,r.dj)(),[b,w]=(0,i.useState)({approver_id:"",notes:"",items:[]}),[q,_]=(0,i.useState)({}),[C,A]=(0,i.useState)(null),R=d.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(h.toLowerCase())),E=(e,s)=>{let t=b.items.findIndex(t=>t.product_id===e.id&&t.variant_id===s?.id);if(t>=0){let e=[...b.items];e[t].quantity+=1,w({...b,items:e})}else{let t={product_id:e.id,variant_id:s?.id,quantity:1,notes:"",product:e,variant:s};w({...b,items:[...b.items,t]})}g("")},P=(e,s)=>{let t=[...b.items];t[e].quantity=Math.max(0,s),w({...b,items:t})},Z=(e,s)=>{let t=[...b.items];t[e].notes=s,w({...b,items:t})},F=e=>{let s=b.items.filter((s,t)=>t!==e);w({...b,items:s})},D=()=>{let e={};return b.approver_id||(e.approver_id="Approver is required"),0===b.items.length&&(e.items="At least one item is required"),b.items.forEach((s,t)=>{s.quantity<=0&&(e[`item_${t}_quantity`]="Quantity must be greater than 0")}),_(e),0===Object.keys(e).length},I=async e=>{if(e.preventDefault(),D()){c(!0);try{let e={approver_id:b.approver_id,notes:b.notes||void 0,items:b.items.map(e=>({product_id:e.product_id,variant_id:e.variant_id||void 0,quantity:e.quantity,notes:e.notes||void 0}))};console.log("Creating requisition with payload:",e);let s=await J(e);console.log("Create requisition response:",s),A(s),"success"===s.status&&(y({title:"Success",description:s.message||"Requisition created successfully."}),t())}catch(e){console.error("Create requisition failed:",e),A({error:e instanceof Error?e.message:"Unknown error"}),y({title:"Error",description:e instanceof Error?e.message:"Failed to create requisition",variant:"destructive"})}finally{c(!1)}}};return(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col h-full",children:[(0,a.jsxs)($.Fm,{children:[(0,a.jsx)($.qp,{children:"Create New Requisition"}),(0,a.jsx)($.Qs,{children:"Add products to create a new requisition request."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto py-4",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Approver"}),(0,a.jsx)(n.BT,{children:"Select the user who will approve this requisition"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"approver_id",children:"Approver *"}),(0,a.jsxs)(v.l6,{value:b.approver_id,onValueChange:e=>w({...b,approver_id:e}),children:[(0,a.jsx)(v.bq,{className:q.approver_id?"border-red-500":"",children:(0,a.jsx)(v.yv,{placeholder:"Select approver"})}),(0,a.jsx)(v.gC,{children:x.map(e=>(0,a.jsx)(v.eb,{value:e.id,children:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]})})},e.id))})]}),q.approver_id&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:q.approver_id})]})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-lg",children:"Add Products"}),(0,a.jsx)(n.BT,{children:"Search and select products to include in this requisition"})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,a.jsx)(j.p,{placeholder:"Search products by name or SKU...",value:h,onChange:e=>g(e.target.value),className:"pl-10"})]}),h&&(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto border rounded-md",children:R.length>0?(0,a.jsx)("div",{className:"divide-y",children:R.slice(0,10).map(e=>(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["SKU: ",e.sku]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Stock: ",e.stock_quantity," ",e.unit_of_measurement]}),e.stock_quantity>0&&e.stock_quantity<=10&&(0,a.jsx)(u.E,{variant:"secondary",className:"text-xs bg-yellow-100 text-yellow-800",children:"Low Stock"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:e.has_variations&&e.variants?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(v.l6,{onValueChange:s=>{let t=e.variants?.find(e=>e.id===s);t&&E(e,t)},children:[(0,a.jsx)(v.bq,{className:"w-40",children:(0,a.jsx)(v.yv,{placeholder:"Select variant"})}),(0,a.jsx)(v.gC,{children:e.variants.map(e=>(0,a.jsx)(v.eb,{value:e.id,disabled:e.stock_quantity<=0,children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["Stock: ",e.stock_quantity]})]})},e.id))})]}),(0,a.jsxs)(p.$,{size:"sm",onClick:()=>E(e),disabled:e.stock_quantity<=0,className:"bg-primary hover:bg-primary/90",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"Add"]})]}):(0,a.jsxs)(p.$,{size:"sm",onClick:()=>E(e),disabled:e.stock_quantity<=0,className:"bg-[#E30040] hover:bg-[#E30040]/90",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"Add"]})})]})},e.id))}):(0,a.jsxs)("div",{className:"p-4 text-center text-gray-500 text-sm",children:['No products found matching "',h,'"']})}),q.items&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-red-600 text-sm",children:[(0,a.jsx)(B.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:q.items})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"text-lg",children:["Selected Items (",b.items.length,")"]}),q.items&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:q.items})]}),(0,a.jsx)(n.Wu,{children:0===b.items.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No items selected yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Search and add products above"})]}):(0,a.jsx)("div",{className:"space-y-4",children:b.items.map((e,s)=>{let t=e.product,i=e.variant,r=i?i.stock_quantity:t?.stock_quantity||0;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:t?.name}),i&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Variant: ",i.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Available: ",r," ",t?.unit_of_measurement]})]}),(0,a.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>F(s),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(k.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Quantity *"}),(0,a.jsx)(j.p,{type:"number",min:"1",value:e.quantity,onChange:e=>P(s,parseInt(e.target.value)||1),className:q[`item_${s}_quantity`]?"border-red-500":""}),q[`item_${s}_quantity`]&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:q[`item_${s}_quantity`]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Item Notes"}),(0,a.jsx)(j.p,{placeholder:"Optional notes for this item...",value:e.notes||"",onChange:e=>Z(s,e.target.value)})]})]})]},`${e.product_id}-${e.variant_id||"no-variant"}-${s}`)})})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-lg",children:"Additional Notes"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)(T.T,{placeholder:"Enter any additional notes for this requisition...",value:b.notes,onChange:e=>w({...b,notes:e.target.value}),rows:3})})]}),C&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[C.error?(0,a.jsx)(B.A,{className:"h-5 w-5 text-red-500"}):(0,a.jsx)(ee.A,{className:"h-5 w-5 text-green-500"}),(0,a.jsx)("span",{children:"API Response"})]})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("pre",{className:"text-sm bg-gray-100 p-3 rounded-md overflow-auto",children:JSON.stringify(C,null,2)})})]})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t mt-auto",children:[(0,a.jsx)(p.$,{type:"button",variant:"ghost",onClick:()=>s(!1),disabled:l,children:"Cancel"}),(0,a.jsx)(p.$,{type:"submit",disabled:l||0===b.items.length,className:"bg-[#E30040] hover:bg-[#E30040]/90",onClick:I,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Requisition"})]})]})})}var et=t(35876);t(56792);var ea=t(93437),ei=t(17313),er=t(96241);function en({open:e,onOpenChange:s,onSuccess:t,requisition:c}){let[d,o]=(0,i.useState)(!1),[x,m]=(0,i.useState)([]),[h,g]=(0,i.useState)([]),{toast:y}=(0,r.dj)(),[N,f]=(0,i.useState)({from_store_id:"",to_entity:"",to_user_id:"",type:"internal",notes:"",items:[]}),[b,w]=(0,i.useState)({}),q=()=>{let e={};return N.from_store_id||(e.from_store_id="From store is required"),N.to_entity||(e.to_entity="To entity is required"),N.to_user_id||(e.to_user_id="To user is required"),0===N.items.length?e.items="At least one item is required":N.items.forEach((s,t)=>{s.quantity<=0&&(e[`item_${t}_quantity`]="Quantity must be greater than 0")}),w(e),0===Object.keys(e).length},_=async()=>{if(q()&&c){o(!0);try{let e={...N,items:N.items.map(e=>({product_id:e.product_id,variant_id:e.variant_id||void 0,quantity:e.quantity,is_returnable:e.is_returnable,return_date:e.return_date||void 0,notes:e.notes||void 0}))},a=await (0,et.DI)(e);"success"===a.status&&(await z(c.id,{status:"dispatched",dispatch_id:a.dispatch.id}),y({title:"Success",description:`Dispatch created successfully for requisition ${c.requisition_number}`}),t(),s(!1))}catch(e){console.error("Error creating dispatch:",e),y({title:"Error",description:"Failed to create dispatch. Please try again.",variant:"destructive"})}finally{o(!1)}}},C=(e,s)=>{f(t=>({...t,items:t.items.map((t,a)=>a===e?{...t,...s}:t)}))};return(0,a.jsx)($.cj,{open:e,onOpenChange:s,children:(0,a.jsxs)($.h,{side:"right",className:"w-full max-w-4xl sm:max-w-4xl p-0 flex flex-col",children:[(0,a.jsx)($.Fm,{className:"px-6 py-4 border-b bg-gradient-to-r from-slate-50 to-white",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-primary/10 rounded-lg",children:(0,a.jsx)(S.A,{className:"h-5 w-5 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)($.qp,{className:"text-xl font-semibold text-gray-900",children:"Create Dispatch from Requisition"}),(0,a.jsx)($.Qs,{className:"text-sm text-gray-500",children:c?`Creating dispatch for requisition ${c.requisition_number}`:"Create a new dispatch"})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[c&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,a.jsx)(l.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Source Requisition"})]}),(0,a.jsx)(n.BT,{children:"Dispatch will be created from this approved requisition"})]}),(0,a.jsx)(n.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Requisition Number"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:c.requisition_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Requester"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[c.requester.first_name," ",c.requester.last_name]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(O.J,{className:"text-sm font-medium",children:"Total Items"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[c.items.length," product",1!==c.items.length?"s":"","(",c.items.reduce((e,s)=>e+s.quantity,0)," total qty)"]})]})]})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"text-lg flex items-center space-x-2",children:[(0,a.jsx)(ei.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Dispatch Information"})]}),(0,a.jsx)(n.BT,{children:"Set up the basic dispatch details"})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"from_store_id",children:"From Store *"}),(0,a.jsxs)(v.l6,{value:N.from_store_id,onValueChange:e=>f(s=>({...s,from_store_id:e})),children:[(0,a.jsx)(v.bq,{className:b.from_store_id?"border-red-500":"",children:(0,a.jsx)(v.yv,{placeholder:"Select store to dispatch from"})}),(0,a.jsx)(v.gC,{children:x.map(e=>(0,a.jsx)(v.eb,{value:e.id,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]}),b.from_store_id&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:b.from_store_id})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"type",children:"Dispatch Type *"}),(0,a.jsxs)(v.l6,{value:N.type,onValueChange:e=>{f(s=>({...s,type:e,to_entity:"internal"===e?"warehouse":""}))},children:[(0,a.jsx)(v.bq,{children:(0,a.jsx)(v.yv,{placeholder:"Select dispatch type"})}),(0,a.jsxs)(v.gC,{children:[(0,a.jsx)(v.eb,{value:"internal",children:"Internal Transfer"}),(0,a.jsx)(v.eb,{value:"external",children:"External Transfer"})]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"to_entity",children:"To Entity *"}),(0,a.jsxs)(v.l6,{value:N.to_entity,onValueChange:e=>f(s=>({...s,to_entity:e})),children:[(0,a.jsx)(v.bq,{className:b.to_entity?"border-red-500":"",children:(0,a.jsx)(v.yv,{placeholder:"Select entity/department",children:N.to_entity?(0,er.zX)(N.to_entity):"Select entity/department"})}),(0,a.jsx)(v.gC,{children:"internal"===N.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.eb,{value:"warehouse",children:"Warehouse"}),(0,a.jsx)(v.eb,{value:"sales",children:"Sales Department"}),(0,a.jsx)(v.eb,{value:"operations",children:"Operations"}),(0,a.jsx)(v.eb,{value:"maintenance",children:"Maintenance"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.eb,{value:"external_company",children:"External Company"}),(0,a.jsx)(v.eb,{value:"customer",children:"Customer"}),(0,a.jsx)(v.eb,{value:"supplier",children:"Supplier"})]})})]}),b.to_entity&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:b.to_entity})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"to_user_id",children:"Assign to User *"}),(0,a.jsxs)(v.l6,{value:N.to_user_id,onValueChange:e=>f(s=>({...s,to_user_id:e})),children:[(0,a.jsx)(v.bq,{className:b.to_user_id?"border-red-500":"",children:(0,a.jsx)(v.yv,{placeholder:"Select user to acknowledge dispatch"})}),(0,a.jsx)(v.gC,{children:h.map(e=>(0,a.jsx)(v.eb,{value:e.id,children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),c&&e.id===c.requester_id&&(0,a.jsx)(u.E,{variant:"secondary",className:"text-xs",children:"Requester"})]})},e.id))})]}),b.to_user_id&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:b.to_user_id})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{htmlFor:"notes",children:"Notes"}),(0,a.jsx)(T.T,{id:"notes",placeholder:"Add any additional notes about this dispatch...",value:N.notes,onChange:e=>f(s=>({...s,notes:e.target.value})),rows:3})]})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"text-lg",children:["Dispatch Items (",N.items.length,")"]}),(0,a.jsx)(n.BT,{children:"Items from the requisition that will be dispatched"})]}),(0,a.jsx)(n.Wu,{children:0===N.items.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(S.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No items to dispatch"})]}):(0,a.jsx)("div",{className:"space-y-4",children:N.items.map((e,s)=>{let t=e.product,i=e.variant;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:t?.name}),i&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Variant: ",i.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["SKU: ",t?.sku||"N/A"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"font-semibold",children:["Qty: ",e.quantity]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t?.unit_of_measurement})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Requested Quantity"}),(0,a.jsx)(j.p,{type:"number",value:e.quantity,readOnly:!0,className:"bg-gray-50"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Return Settings"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ea.S,{checked:e.is_returnable,onCheckedChange:e=>C(s,{is_returnable:!!e})}),(0,a.jsx)("span",{className:"text-sm",children:"Returnable"})]}),e.is_returnable&&(0,a.jsx)(j.p,{type:"date",value:e.return_date,onChange:e=>C(s,{return_date:e.target.value}),className:"text-sm"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.J,{children:"Item Notes"}),(0,a.jsx)(j.p,{placeholder:"Optional notes for this item...",value:e.notes,onChange:e=>C(s,{notes:e.target.value})})]})]})]},s)})})})]})]}),(0,a.jsxs)($.XW,{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[(0,a.jsx)(p.$,{variant:"ghost",onClick:()=>s(!1),children:"Cancel"}),(0,a.jsxs)(p.$,{onClick:_,disabled:d||0===N.items.length,className:"bg-primary hover:bg-primary/90",children:[d?(0,a.jsx)(L.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Create Dispatch"]})]})]})})}var el=t(7803);function ec(){let[e,s]=(0,i.useState)([]),[t,n]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1),[d,o]=(0,i.useState)(!1),[x,h]=(0,i.useState)(!1),[u,p]=(0,i.useState)(null),[j,v]=(0,i.useState)(!1),[g,y]=(0,i.useState)(null),[N,f]=(0,i.useState)(!1),[b,w]=(0,i.useState)(null),[q,_]=(0,i.useState)(!1),[C,A]=(0,i.useState)(null),[S,R]=(0,i.useState)(!0),[k,P]=(0,i.useState)(""),[$,Z]=(0,i.useState)(null),[F,D]=(0,i.useState)(1),[O,T]=(0,i.useState)(10),{toast:B}=(0,r.dj)(),L=async()=>{R(!0);try{let e=await W();s(e.data.data)}catch(e){console.error("Error fetching requisitions:",e),B({title:"Error",description:"Failed to fetch requisitions. Please try again.",variant:"destructive"})}finally{R(!1)}},I=e.filter(e=>e.requisition_number.toLowerCase().includes(k.toLowerCase())||e.requester.first_name.toLowerCase().includes(k.toLowerCase())||e.requester.last_name.toLowerCase().includes(k.toLowerCase())||e.status.toLowerCase().includes(k.toLowerCase())||e.approval_status.toLowerCase().includes(k.toLowerCase())||e.notes&&e.notes.toLowerCase().includes(k.toLowerCase())),J=Math.ceil(I.length/O),M=(F-1)*O,U=I.slice(M,M+O),z=e=>{A(e),_(!0)};return(0,a.jsx)(el.PermissionGuard,{permissions:["can_view_requisitions_menu","can_manage_system","can_manage_company"],children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Requisitions"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage and track product requisitions across your organization"})]}),(0,a.jsx)(m,{requisitions:e,loading:S}),(0,a.jsx)(E,{requisitions:U,loading:S,onViewRequisition:e=>{n(e),c(!0)},onEditRequisition:e=>{p(e),h(!0)},onDeleteRequisition:e=>{y(e),v(!0)},onApproveRequisition:e=>{w(e),f(!0)},onCreateDispatch:z,search:k,onSearchChange:P,currentPage:F,totalPages:J,rowsPerPage:O,onPageChange:D,onRowsPerPageChange:T,totalItems:I.length,onRefresh:L,onCreateNew:()=>o(!0)}),(0,a.jsx)(Y,{open:l,onOpenChange:c,requisition:t,onClose:()=>{c(!1),n(null)},onRefresh:()=>{L()},onCreateDispatch:z}),(0,a.jsx)(es,{open:d,onOpenChange:o,onSuccess:()=>{o(!1),L(),B({title:"Success",description:"Requisition created successfully."})}}),(0,a.jsx)(V,{open:x,onOpenChange:h,onSuccess:()=>{h(!1),p(null),L(),B({title:"Success",description:"Requisition updated successfully."})},requisition:u}),(0,a.jsx)(K,{open:j,onOpenChange:v,onSuccess:()=>{v(!1),y(null),L()},requisition:g}),(0,a.jsx)(X,{open:N,onOpenChange:f,onSuccess:()=>{f(!1),w(null),L()},requisition:b}),(0,a.jsx)(en,{open:q,onOpenChange:_,onSuccess:()=>{_(!1),A(null),L()},requisition:C})]})})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23493:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>d});var a=t(65239),i=t(48088),r=t(88170),n=t.n(r),l=t(30893),c={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d={children:["",{children:["requisitions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,15361)),"/Users/inchwara/sawela/app/requisitions/page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,30906)),"/Users/inchwara/sawela/app/requisitions/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,58014)),"/Users/inchwara/sawela/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["/Users/inchwara/sawela/app/requisitions/page.tsx"],x={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/requisitions/page",pathname:"/requisitions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30906:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(37413),i=t(56254);function r({children:e}){return(0,a.jsx)(i.e,{children:e})}},31158:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(62688).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},33873:e=>{"use strict";e.exports=require("path")},35071:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(62688).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},41792:(e,s,t)=>{Promise.resolve().then(t.bind(t,5983))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71168:(e,s,t)=>{Promise.resolve().then(t.bind(t,17869))},72840:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(62688).A)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},93613:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(62688).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[7719,6447,3399,5814,7676,1126,4097,5902,5650,7895,4248,1158,6173,1231,5767,8369],()=>t(23493));module.exports=a})();