{
  "info": {
    "name": "Customer Account API",
    "description": "Postman collection for Citimax ERP Customer Account operations",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "customer-account-api-collection",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    }
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{auth_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://your-api-domain.com/api",
      "type": "string",
      "description": "Base URL for the API"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string",
      "description": "Bearer token for authentication"
    }
  ],
  "item": [
    {
      "name": "Create Customer Account",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"customer_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"certificate_of_incorporation_number\": \"C123456789\",\n  \"annual_turnover\": 1000000.00,\n  \"credit_required\": 50000.00,\n  \"credit_period_required\": \"30 days\",\n  \"currently_defaulted\": false,\n  \"credit_terms\": \"Net 30\",\n  \"notes\": \"Sample customer account for testing\",\n  \"documents\": [\n    {\n      \"document_name\": \"Business License\",\n      \"reference_number\": \"BL-2024-001\",\n      \"expiry_date\": \"2025-12-31\",\n      \"regulatory_body\": \"Kenya Bureau of Standards (KEBS)\",\n      \"other_information\": \"Valid business license\"\n    }\n  ],\n  \"directors\": [\n    {\n      \"name\": \"John Doe\",\n      \"id_passport_number\": \"A1234567\",\n      \"pin\": \"P123456789\",\n      \"phone_number\": \"+254712345678\"\n    },\n    {\n      \"name\": \"Jane Smith\",\n      \"id_passport_number\": \"B7654321\",\n      \"pin\": \"P987654321\",\n      \"phone_number\": \"+254723456789\"\n    }\n  ],\n  \"authorised_purchase_persons\": [\n    {\n      \"name\": \"Mike Johnson\",\n      \"phone_number\": \"+254734567890\"\n    },\n    {\n      \"name\": \"Sarah Wilson\",\n      \"phone_number\": \"+254745678901\"\n    }\n  ],\n  \"suppliers\": [\n    {\n      \"name\": \"ABC Suppliers Ltd\",\n      \"contact_person_name\": \"Robert Brown\",\n      \"phone_number\": \"+254756789012\",\n      \"credit_limit\": \"25000\"\n    },\n    {\n      \"name\": \"XYZ Trading Co\",\n      \"contact_person_name\": \"Lisa Green\",\n      \"phone_number\": \"+254767890123\",\n      \"credit_limit\": \"15000\"\n    }\n  ],\n  \"bank_details\": [\n    {\n      \"bank_name\": \"Equity Bank\",\n      \"branch\": \"Westlands\",\n      \"account_number\": \"1234567890\"\n    },\n    {\n      \"bank_name\": \"KCB Bank\",\n      \"branch\": \"CBD\",\n      \"account_number\": \"0987654321\"\n    }\n  ]\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/customer-accounts",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-accounts"
          ]
        },
        "description": "Creates a new customer credit account with all related information including directors, authorized persons, suppliers, and bank details."
      },
      "response": [
        {
          "name": "Success Response",
          "originalRequest": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customer_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"certificate_of_incorporation_number\": \"C123456789\",\n  \"annual_turnover\": 1000000.00,\n  \"credit_required\": 50000.00,\n  \"credit_period_required\": \"30 days\",\n  \"currently_defaulted\": false,\n  \"credit_terms\": \"Net 30\",\n  \"notes\": \"Sample customer account\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/customer-accounts",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "customer-accounts"
              ]
            }
          },
          "status": "Created",
          "code": 201,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "cookie": [],
          "body": "{\n  \"status\": \"success\",\n  \"message\": \"Customer account created successfully\",\n  \"data\": {\n    \"id\": \"123e4567-e89b-12d3-a456-426614174000\",\n    \"customer_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"company_id\": \"company-uuid-here\",\n    \"account_number\": \"ACC-2024-001\",\n    \"certificate_of_incorporation_number\": \"C123456789\",\n    \"annual_turnover\": \"1000000.00\",\n    \"credit_required\": \"50000.00\",\n    \"credit_period_required\": \"30 days\",\n    \"currently_defaulted\": false,\n    \"credit_terms\": \"Net 30\",\n    \"notes\": \"Sample customer account\",\n    \"created_by\": \"user-uuid-here\",\n    \"created_at\": \"2024-10-14T10:00:00Z\",\n    \"updated_at\": \"2024-10-14T10:00:00Z\",\n    \"directors\": [],\n    \"authorised_purchase_persons\": [],\n    \"suppliers\": [],\n    \"bank_details\": [],\n    \"documents\": [],\n    \"customer\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"name\": \"John Doe\",\n      \"email\": \"john@example.com\"\n    }\n  }\n}"
        },
        {
          "name": "Error Response - UUID Issue",
          "originalRequest": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customer_id\": \"invalid-uuid\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/customer-accounts",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "customer-accounts"
              ]
            }
          },
          "status": "Internal Server Error",
          "code": 500,
          "_postman_previewlanguage": "json",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "cookie": [],
          "body": "{\n  \"status\": \"failed\",\n  \"message\": \"Failed to create customer account: SQLSTATE[22P02]: Invalid text representation: 7 ERROR: invalid input syntax for type uuid: \\\"12345\\\"\\nLINE 1: ...where \\\"users\\\".\\\"role_id\\\" = \\\"roles\\\".\\\"id\\\" and \\\"id\\\" = '12345') a...\\n                                                             ^ (Connection: pgsql, SQL: select * from \\\"users\\\" where exists (select * from \\\"roles\\\" where \\\"users\\\".\\\"role_id\\\" = \\\"roles\\\".\\\"id\\\" and \\\"id\\\" = 12345) and \\\"is_active\\\" = true limit 1)\"\n}"
        }
      ]
    },
    {
      "name": "Get Customer Accounts",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/customer-accounts",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-accounts"
          ]
        },
        "description": "Retrieves all customer accounts for the authenticated user's company."
      }
    },
    {
      "name": "Get Customer Account by ID",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/customer-accounts/{{account_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-accounts",
            "{{account_id}}"
          ]
        },
        "description": "Retrieves a specific customer account by its ID."
      }
    },
    {
      "name": "Update Customer Account",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"certificate_of_incorporation_number\": \"C987654321\",\n  \"annual_turnover\": 1500000.00,\n  \"credit_required\": 75000.00,\n  \"credit_period_required\": \"45 days\",\n  \"currently_defaulted\": false,\n  \"credit_terms\": \"Net 45\",\n  \"notes\": \"Updated customer account information\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/customer-accounts/{{account_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-accounts",
            "{{account_id}}"
          ]
        },
        "description": "Updates an existing customer account."
      }
    },
    {
      "name": "Delete Customer Account",
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/customer-accounts/{{account_id}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-accounts",
            "{{account_id}}"
          ]
        },
        "description": "Deletes a customer account by its ID."
      }
    },
    {
      "name": "Create Customer Account Approval",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{auth_token}}",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"customer_account_id\": \"{{account_id}}\",\n  \"approved_by\": \"{{user_id}}\",\n  \"approval_status\": \"approved\",\n  \"approval_notes\": \"Account approved after reviewing all documents and financial information.\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{base_url}}/customer-account-approvals",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "customer-account-approvals"
          ]
        },
        "description": "Creates an approval record for a customer account."
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// You can add pre-request scripts here",
          "// For example, to automatically set timestamps or generate UUIDs",
          "",
          "// Generate a sample UUID for testing",
          "function generateUUID() {",
          "    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {",
          "        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);",
          "        return v.toString(16);",
          "    });",
          "}",
          "",
          "// Set a sample customer ID if not already set",
          "if (!pm.collectionVariables.get('sample_customer_id')) {",
          "    pm.collectionVariables.set('sample_customer_id', generateUUID());",
          "}",
          "",
          "// Set a sample account ID if not already set", 
          "if (!pm.collectionVariables.get('account_id')) {",
          "    pm.collectionVariables.set('account_id', generateUUID());",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Common test scripts for all requests",
          "",
          "// Test for successful response",
          "pm.test('Response status code is successful', function () {",
          "    pm.expect(pm.response.code).to.be.oneOf([200, 201, 204]);",
          "});",
          "",
          "// Test for JSON response",
          "pm.test('Response is JSON', function () {",
          "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "});",
          "",
          "// Test response time",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "// Store response data for subsequent requests",
          "if (pm.response.code === 200 || pm.response.code === 201) {",
          "    const responseJson = pm.response.json();",
          "    if (responseJson.data && responseJson.data.id) {",
          "        pm.collectionVariables.set('last_created_id', responseJson.data.id);",
          "    }",
          "}"
        ]
      }
    }
  ]
}